!function(t,e,i,a){"use strict";var n={columns:null,data:null,url:null,queryParams:{},pager:!1,pageNumber:1,pageSize:5,rowHeight:40,height:null,noDataText:"没有数据",footer:!1,footerMsg:"共{total}条",queryFilter:null,loadFilter:null,onBeforeLoad:null,onLoadSuccess:null},r={name:"csgrid",getCls:function(){var t=this.name+"-";return{load:t+"f",header:t+"header",body:t+"body",footer:t+"footer",noData:t+"nodata",cell:t+"cell",emptyCell:t+"emptycell"}},init:function(t){var e=t.options,i=e.columns;i&&0!==i.length&&(e.mergeColumns=this.mergeCols(i),e.realData={total:0,rows:[]},this.cls||(this.cls=this.getCls()),this.grid(t).attr("id",t.instanceId),this.initHeader(t),this.reload(t))},template:function(e,i){if(!e||!i)return e;var a=e.match(/{(.*?)}/g);return t.each(a,function(t,a){var n=a.replace(/{(.*?)}/g,"$1"),r=i[n];void 0!==r&&(e=e.replace(a,r))}),e},grid:function(e,i){var a,n=t(e.dom),r=this.cls,s=r.load;return n.hasClass(s)?(a=n.parent(),i?this.child(a,i):a):(n.addClass(s).hide(),a=t('<div class="'+this.name+'"><div class="'+r.header+'"></div><div class="'+r.body+'"></div></div>'),a.insertAfter(n),n.appendTo(a),a)},child:function(t,e){return t.children("div."+this.cls[e])},mergeCols:function(e){var i=e[0],a=e[1],n=[];if(!t.isArray(i))return e;var r=a&&a.concat();return t.each(i,function(t,e){var i=e.field,a=e.colspan;if(i)n.push(e);else if(a&&r){var s=r.splice(0,a);n=n.concat(s)}}),n},initHeader:function(e){this.resize(e);var i=t("<table><tbody></tbody></table>");this.grid(e,"header").html(i),this.fillHeader(i.children("tbody"),e.options.columns)},fillHeader:function(e,i){var a=t("<tr></tr>"),n=!0,r=this,s=r.cls.cell;t.each(i,function(i,o){if(t.isArray(o))return n=!1,void r.fillHeader(e,o);var l="<td",d="<div",c=o.colspan,h=o.rowspan,u=o.haligh,f=o.field,p=o.title;c&&(l+=' colspan="'+c+'"'),h&&(l+=' rowspan="'+h+'"'),f&&(d+=' class="'+s+" "+s+"-"+f+'"'),u&&(d+=' style="text-align:'+u+';"'),d+=' title="'+p+'">'+p+"</div>",l+=">"+d+"</td>",a.append(l)}),n&&e.append(a)},getColWitdh:function(t,e){var i=parseInt(t);return isNaN(i)?"auto":parseInt(/%$/.test(t)?i/100*e:i)-2+"px"},createCellStyle:function(e,i,a){var n=i.options.mergeColumns,r=i.instanceId,s=this,o=['<style type="text/css" '+s.name+'="true" data-target="'+r+'">'],l=s.cls.cell+"-";t.each(n,function(t,e){var i=e.field;if(i){var n=s.getColWitdh(e.width,a);"auto"!==n&&o.push("#"+r+" ."+l+i+"{width:"+n+"}")}}),o.push("</style>"),t(o.join("\n")).appendTo(e)},removeCellStyle:function(t){t.children("style["+this.name+"]").remove()},resize:function(t){var e=this.grid(t);if(!e.is(":hidden")){var i=this.child(e,"header"),a=this.child(e,"body"),n=a.children("table"),r=parseInt(e.css("width"));this.hasScrollbar(a)&&(r-=20,this.addEmptyCell(i)),parseInt(n.css("width"))===r&&e.children("style[data-target="+t.instanceId+"]").length>0||(n.css("width",r),i.children("table").css("width",r),this.removeCellStyle(e),this.createCellStyle(e,t,r))}},hasScrollbar:function(t){var e=t.children("table")[0];return e&&parseInt(t.css("height"))<parseInt(e.style.height)},addEmptyCell:function(t){var e=this.cls.emptyCell,i='<div class="'+e+'"></div>';0===t.children("."+e).length&&t.append(i)},initBody:function(t,e){var i=t.options,a=this.grid(t,"body");return a.empty().css("height",e?"auto":i.height||i.pageSize*i.rowHeight),a},showNoData:function(t){this.initBody(t,!0).html('<div class="'+this.cls.noData+'">'+t.options.noDataText+"</div>")},initFooter:function(e){var i,a=this.grid(e),n=this.child(a,"footer"),r=e.options,s=r.footer,o=r.realData;if("function"==typeof s)i=s.call(e.dom,o);else{if(s!==!0)return;i=this.template(r.footerMsg,o)}0===n.length&&(n=t('<div class="'+this.cls.footer+'"></div>'),n.appendTo(a)),n.html(i)},reload:function(t){this.initBody(t);var e=t.options,i=e.onBeforeLoad;i&&i.call(t.dom),e.url?this.ajaxData(t):this.loadData(t)},parseData:function(e){var i=e.data;if(e.pager&&t.isArray(i)){var a=e.pageNumber*e.pageSize,n=a-e.pageSize;i=i.slice(n,a)}return t.isArray(i)?{total:e.data.length,rows:i}:i},ajaxData:function(e){var i=e.options,a=this;if(i.pager){var n=i.queryParams,r=i.queryFilter;t.extend(n,{page:i.pageNumber,row:i.pageSize}),r&&(n=r.call(e.dom,n)),i.queryParams=n}t.post(i.url,i.queryParams,function(t){i.data=t,a.loadData(e)})},loadData:function(e){var i=e.options,a=e.dom,n=i.loadFilter,r=i.onLoadSuccess;n&&(i.data=n.call(a,i.data));var s=this.parseData(i);if(i.realData=s,this.initFooter(e),s&&s.total){var o=this.cls,l=this.grid(e),d=this.child(l,"body"),c=t("<table><tbody></tbody></table>"),h=c.children("tbody"),u=i.mergeColumns,f=s.rows,p=f.length*i.rowHeight,g=i.height,v=o.cell;(!g||g>p)&&d.css("height",p),c.css("height",p).appendTo(d),this.resize(e),t.each(f,function(e,i){var a=t('<tr data-index="'+e+'"></tr>');t.each(u,function(t,n){var r=n.field;if(r){var s=void 0===i[r]?"":i[r],o="",l="",d=n.rowStyler,c=n.formatter,h=n.tooltip,u=n.align,f=a[0];d&&(o=d.call(f,s,e,i)),c&&(s=c.call(f,s,e,i)),"function"==typeof h?l=h.call(f,s,e,i):h===!0&&(l=s);var p='<div class="'+v+" "+v+"-"+r+'"';u?(p+=' style="text-align:'+u+";",o&&(p+=o),p+='"'):o&&(p+=' style="'+o+'"'),l&&(p+=' title="'+l+'"'),p+=">"+s+"</td>",a.append("<td>"+p+"</td>")}}),h.append(a)})}else this.showNoData(e);r&&r.call(a,s)}},s=function(e,i){this.instanceId=r.name+(new Date).valueOf(),this.dom=e,this.options=t.extend({},n,i)};s.prototype={constructor:s,init:function(){r.init(this)},reload:function(e){t.extend(this.options,e),r.reload(this)},loadData:function(t){this.reload({data:t})},grid:function(t){return r.grid(this,t)},resize:function(){return r.resize(this)}},e.csGrid=s,t.fn.csgrid=function(e,i){return"string"==typeof e?t.fn.csgrid.methods[e](this[0],i):this.each(function(){var i=new s(this,e);return t.data(this,r.name,i),i.init(),i})},t.fn.csgrid.methods={instance:function(e){return t.data(e,r.name)},options:function(t){return this.instance(t).options},reload:function(t,e){return this.instance(t).reload(e)},loadData:function(t,e){return this.instance(t).loadData(e)},getData:function(t){return this.options(t).realData},grid:function(t,e){return this.instance(t).grid(e)},body:function(t){return this.grid(t,"body")},resize:function(t){return this.instance(t).resize()}}}(jQuery,window,document);