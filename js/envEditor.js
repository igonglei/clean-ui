!function(e,t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("jquery")):e.enxHelper=t(e.jQuery)}(this,function(d){var e=new function(){var a=this;this.GlobalVar=new function(){this.XMLTAG="<\\?xml.*\\?>",this.ExceptionNode="#text",this.IllegalTagEnd="/>",this.LawfulTagEnd="></parameter>",this.LinkTag="link>",this.LinkTagReplace="linkC>",this.UserDefineField=[],this.SpaceCount=2,this.FormatTpl=new function(){this.Paratemter="<parameter{0}/>",this.Link="<link>{0}</link>",this.CDATA="<![CDATA[{0}]]>"},this.ElemntIndex=new function(){this.Link=1,this.Ne=1,this.Board=1,this.SubBoard=1,this.Port=1,this.Tester=1,this.Dev=1,this.Atm=1,this.Eth=1,this.Sdh=1,this.Sftp=1,this.Agent=1,this.VM=1,this.Network=1},this.DeaultElemntIndex=new function(){this.Link=1,this.Ne=1,this.Board=1,this.SubBoard=1,this.Port=1,this.Tester=1,this.Dev=1,this.Atm=1,this.Eth=1,this.Sdh=1,this.Sftp=1,this.Agent=1,this.VM=1,this.Network=1}},this.Field={ID:"_id",BigType:"BigType",ParentGID:"ParentGID",IsTopDevice:"IsTopDevice",Name:"Name"},this.SpecialField={IP:"ip"},this.ModelType={Env:"Env",Ne:"Ne",Board:"Board",SubBoard:"SubBoard",Port:"Port",Link:"Link",Topolimit:"Topolimit",Tester:"Tester",Dev:"Dev",Atm:"Atm",Eth:"Eth",Sdh:"Sdh",Network:"Network",Sftp:"Sftp",Agent:"Agent",VM:"VM",Other:"Other"},this.ModelTypeOfTopDevice=[this.ModelType.Ne,this.ModelType.Atm,this.ModelType.Tester,this.ModelType.Dev,this.ModelType.Eth,this.ModelType.Sdh,this.ModelType.Network,this.ModelType.Sftp,this.ModelType.Agent],this.ResetMaxIndex=function(e,t){t=t.match(new RegExp("0|[1-9]\\d*","gm"));t&&0<t.length&&this.GlobalVar.ElemntIndex[e]<=parseInt(t[t.length-1])&&(this.GlobalVar.ElemntIndex[e]=parseInt(t[t.length-1])+1)},this.PreDealEnxContent=function(e){return e.replace(new RegExp(this.GlobalVar.XMLTAG,"gm"),"").replace(new RegExp(a.GlobalVar.IllegalTagEnd,"gm"),a.GlobalVar.LawfulTagEnd).replace(new RegExp(a.GlobalVar.LinkTag,"gm"),a.GlobalVar.LinkTagReplace)},this.EnxToLstJson=function(e){var o=this;this.GlobalVar.ElemntIndex=this.GlobalVar.DeaultElemntIndex;var i=[];if(!e)return i;var e=this.PreDealEnxContent(e),e=d(e)[0],l={};l[h.RootNodeAttr]=a.GetNodeAttr(e);e=a.GetChildNode(e);return d.each(e,function(e,t){switch(t.tagName){case h.NodeName.ENXFILE_NODE_PARAMETERS:var n=a.ParameterNodeToJson(t);l=u.CombineJson(n,l),i.push(l);break;case h.NodeName.ENXFILE_NODE_DEVICES:n=a.GetChildNode(t);d(n).each(function(e,t){t=a.DeviceNodeToJson(t,l,!0);i=i.concat(t)});break;case h.NodeName.ENXFILE_NODE_LINKS:var r=a.GetChildNode(t);d(r).each(function(e,t){t=a.LinkNodeToJson(t);t&&t.objname&&t.objname.value&&(t[a.Field.ParentGID]=u.GetStrValue(l,a.Field.ID),i.push(t),o.ResetMaxIndex(a.ModelType.Link,t.objname.value))});break;case h.NodeName.ENXFILE_NODE_TOPOLIMIT:r={};r[a.Field.BigType]=a.ModelType.Topolimit,r[a.Field.ParentGID]=u.GetStrValue(l,a.Field.ID),r[a.Field.Name]=a.MatchTopLimit(d.trim(t.innerHTML)),r[a.Field.ID]=a.CreateNewGuid(),i.push(r)}}),i},this.LstJsonToEnx=function(e){if(!e||0==e.length)return"";var t,n=d(h.XMLTAG.LOGIC_ENVIRONMENT),r=u.GetJsonByKey(e,a.Field.BigType,a.ModelType.Env),o=(r=!u.IsJsonObj(r)||u.IsEmptyJson(r)||!r?a.ParameterNodeToJson(null):r)[h.RootNodeAttr];for(t in o)n.attr(t,u.GetStrValue(o,t));var i=d(h.XMLTAG.PARAMETERSTAG);i[0].innerText=a.XmlGetParameter(r,!0),n.append(i),a.XMLJsonToNode(r,n,e);var i=d(h.XMLTAG.LINKS),r=u.FilterListByValues(e,a.Field.BigType,[a.ModelType.Link]),l="";d.each(r,function(e,t){l+=a.Format(a.GlobalVar.FormatTpl.Link,a.XmlGetParameter(t))}),i[0].innerText=l,n.append(i);i=u.GetJsonByKey(e,a.Field.BigType,a.ModelType.Topolimit),e=d(h.XMLTAG.TOPOLIMIT);return e[0].innerText=a.Format(a.GlobalVar.FormatTpl.CDATA,i[a.Field.Name]||""),n.append(e),n[0].outerHTML},this.XmlGetParameter=function(e,t){0==this.GlobalVar.UserDefineField.length&&(this.GlobalVar.UserDefineField=u.GetJsonAllValue(a.Field),this.GlobalVar.UserDefineField.push(h.RootNodeAttr));var n,r="";for(n in e)if(this.GlobalVar.UserDefineField.indexOf(n)<0){var o,i=e[n],l="";for(o in i)l+=" "+o+'="'+this.DealSpecialSingal(i[o])+'"';r+=a.Format(a.GlobalVar.FormatTpl.Paratemter,l)}return r},this.DealSpecialSingal=function(e){return null!=e&&null!=e&&e&&(-1<(e=-1<(e=-1<(e=-1<e.indexOf('"')?e.replace(new RegExp('"',"gm"),"★"):e).indexOf("&")?e.replace(new RegExp("&","gm"),"♣"):e).indexOf("<")?e.replace(new RegExp("<","gm"),"◀"):e).indexOf(">")&&(e=e.replace(new RegExp(">","gm"),"▶"))),e},this.XMLJsonToNode=function(e,t,i){var n,l,r=u.GetStrValue(e,a.Field.ID);(n=e.BigType==a.ModelType.Env?u.FilterListByValues(i,a.Field.IsTopDevice,[h.BoolStr.Yes]):u.FilterListByValues(i,a.Field.ParentGID,[r]))&&0<n.length&&(l=d(h.XMLTAG.DEVICES),d.each(n,function(e,t){var n=d(h.XMLTAG.DEVICE),r=d(h.XMLTAG.PARAMETERSTAG),o=a.XmlGetParameter(t);r[0].innerText=o,n.append(r),a.XMLJsonToNode(t,n,i),l.append(n)}),t.append(l))},this.GetUserDefineField=function(){},this.LinkNodeToJson=function(e){var r={},e=a.GetChildNode(e);return d.each(e,function(e,t){var n=d(t).attr(h.AttrName.ENXFILE_ATTR_NAME);n&&(r[a.Field.BigType]=a.ModelType.Link,r[n]=a.GetNodeAttr(t))}),this.NodeAttachFieldId(r),r},this.NodeAttachFieldId=function(e){var t=u.GetJsonValue(e,h.AttrName.ENXFILE_ATTR_GUID),t=u.GetStrValue(t,h.AttrName.ENXFILE_ATTR_VALUE)||a.CreateNewGuid();e[a.Field.ID]=t},this.ParameterNodeToJson=function(e){var r={};r[a.Field.BigType]=a.ModelType.Env;e=a.GetChildNode(e);return d.each(e,function(e,t){var n=d(t).attr(h.AttrName.ENXFILE_ATTR_NAME);r[n]=a.GetNodeAttr(t)}),this.NodeAttachFieldId(r),r},this.DeviceNodeToJson=function(e,t,n){var r=[],o={};o[a.Field.ParentGID]=t[a.Field.ID]||"",o[a.Field.IsTopDevice]=n?h.BoolStr.Yes:h.BoolStr.No;var i=[],e=a.GetChildNode(e);return d.each(e,function(e,t){var n=t.tagName,r=a.GetChildNode(t);switch(n){case h.NodeName.ENXFILE_NODE_DEVICES:d.each(r,function(e,t){t=a.DeviceNodeToJson(t,o);i=i.concat(t)});break;case h.NodeName.ENXFILE_NODE_PARAMETERS:d.each(r,function(e,t){var n,r=d(t).attr(h.AttrName.ENXFILE_ATTR_NAME);r==h.AttrName.ENXFILE_ATTR_CLASS&&(n=d(t).attr(h.AttrName.ENXFILE_ATTR_VALUE),o[a.Field.BigType]=a.GetDeviceType(n)),o[r]=a.GetNodeAttr(t)}),o.objname.value,a.NodeAttachFieldId(o)}}),o.objname&&(this.ResetMaxIndex(o[a.Field.BigType],o.objname.value),r.push(o),r=r.concat(i)),r},this.MatchTopLimit=function(e){return e.replace("\x3c!--[CDATA[","").replace("]]--\x3e","")},this.GetDeviceType=function(e){var t="";switch(e){case h.SpecialName.ENXFILE_SPECIAL_TESTERTYPE:t=a.ModelType.Tester;break;case h.SpecialName.ENXFILE_SPECIAL_DEVTYPE:t=a.ModelType.Dev;break;case h.SpecialName.ENXFILE_SPECIAL_UNKOWNTYPEATM:t=a.ModelType.Atm;break;case h.SpecialName.ENXFILE_SPECIAL_UNKOWNTYPEETH:t=a.ModelType.Eth;break;case h.SpecialName.ENXFILE_SPECIAL_UNKOWNTYPESDH:t=a.ModelType.Sdh;break;default:t=e}return t},this.GetNodeAttr=function(e){e=e.attributes,e=d.makeArray(e);e.sort(function(e,t){return h.AttrDic[e.name]-h.AttrDic[t.name]});var n={};return d.each(e,function(e,t){n[t.name]=t.value}),n},this.CreateNewGuid=function(){for(var e="",t=1;t<=32;t++)e+=Math.floor(16*Math.random()).toString(16),8!=t&&12!=t&&16!=t&&20!=t||(e+="-");return e},this.Format=function(n,e){return 1==arguments.length?function(){var e=d.makeArray(arguments);return e.unshift(n),a.Format.apply(this,e)}:((e=2<arguments.length&&e.constructor!=Array?d.makeArray(arguments).slice(1):e).constructor!=Array&&(e=[e]),d.each(e,function(e,t){n=n.replace(new RegExp("\\{"+e+"\\}","g"),t)}),n)},this.GetChildNode=function(e){var n=[];return e&&e.childNodes&&d.each(e.childNodes,function(e,t){t.nodeName!=a.GlobalVar.ExceptionNode&&n.push(t)}),n},this.GetQueryString=function(e){e=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),e=window.location.search.substr(1).match(e);return null!=e?unescape(e[2]):null},this.AttrParameter=function(e,t){var n={};return n[h.AttrName.ENXFILE_ATTR_NAME]=e,n[h.AttrName.ENXFILE_ATTR_VALUE]=t||"",n}},h=new function(){this.RootNodeAttr="rootNodeAttr",this.NodeName={ENXFILE_NODE_DEVICES:"DEVICES",ENXFILE_NODE_LINKS:"LINKS",ENXFILE_NODE_TOPOLIMIT:"TOPOLIMIT",ENXFILE_NODE_LINK:"LINK",ENXFILE_NODE_DEVICE:"DEVICE",ENXFILE_NODE_PARAMETER:"PARAMETER",ENXFILE_NODE_PARAMETERS:"PARAMETERS"},this.AttrName={ENXFILE_ATTR_NAME:"name",ENXFILE_ATTR_OBJNAME:"objname",ENXFILE_ATTR_VALUE:"value",ENXFILE_ATTR_GROUPSHOW:"groupshow",ENXFILE_ATTR_CLASS:"class",ENXFILE_ATTR_SOURCETOPDEVICENAME:"sourcetopdevicename",ENXFILE_ATTR_TARGETTOPDEVICENAME:"targettopdevicename",ENXFILE_ATTR_SOURCEDEVICEID:"sourcedeviceid",ENXFILE_ATTR_TARGETDEVICEID:"targetdeviceid",ENXFILE_ATTR_GUID:"guid",ENXFILE_ATTR_ROLER:"roler",ENXFILE_ATTR_FULLCLASS:"fullclass",ENXFILE_ATTR_POSITION:"position",ENXFILE_ATTR_INTERFACE:"interface"},this.SpecialName={ENXFILE_SPECIAL_TESTERTYPE:"Instru::Tester",ENXFILE_SPECIAL_DEVTYPE:"Instru::Dev",ENXFILE_SPECIAL_UNKOWNTYPEETH:"Instru::Eth::Chassis",ENXFILE_SPECIAL_UNKOWNTYPEATM:"Instru::Atm::Chassis",ENXFILE_SPECIAL_UNKOWNTYPESDH:"Instru::Sdh",ENXFILE_SPECIAL_UNKOWNTYPECONNECT:"Connect"},this.XMLTAG=new function(){this.LOGIC_ENVIRONMENT="<logic_environment></logic_environment>",this.PARAMETERSTAG="<parameters></parameters>",this.DEVICES="<devices></devices>",this.LINKS="<links></links>",this.TOPOLIMIT="<topolimit></topolimit>",this.DEVICE="<device></device>",this.LINK="<link></link>",this.PARAMETER="<parameter/>"},this.AttrDic={name:10,value:11,notnull:12,visible:13,readonly:14,description:15,version:16},this.BoolStr={Yes:"yes",No:"no"},this.NameSeparate="_",this.NamePoint="to",this.ClassSeparate="::"},u=new function(){this.SetJsonByKey=function(e,t,n,r,o){if(e&&0<e.length)for(var i=0;i<e.length;i++){var l=e[i];this.IsContainKey(r,l[t])?l[n]=o[r[l[t]].toString()]:l[n]=o.default}return{}},this.GetJsonByKey=function(e,t,n){var r={};if(e&&0<e.length)for(var o=0;o<e.length;o++){var i=e[o];if(i[t]==n){r=i;break}}return r},this.GetJsonByKeyAndSecondKey=function(e,t,n,r){var o={};if(e&&0<e.length)for(var i=0;i<e.length;i++){var l=e[i];if(l[t][n]==r){o=l;break}}return o},this.GetJsonKeyList=function(e){var t,n=[];for(t in e)n.push(e[t]);return n},this.ParseJsonToArr=function(e){var t,n=[];for(t in e){var r={Name:t,Value:e[t]};n.push(r)}return n},this.GetJsonAllValue=function(e){var t,n=[];for(t in e)n.push(e[t]);return n},this.GetJsonAllKey=function(e){var t,n=[];for(t in e)n.push(t);return n},this.CopyJson=function(e){var t={};return e&&(e=d.toJSON(e),t=this.strJsonToJsonObj(e)),t},this.IsEmptyJson=function(e){var t=!0;if(e)for(var n in e){t=!1;break}return t},this.IsContainKey=function(e,t){var n=!1;if(e)for(var r in e)if(r==t){n=!0;break}return n},this.ParseArrStrToArrJson=function(e){var n=[];return e&&0<e.length&&d(e).each(function(e,t){n.push(JSON.parse(t))}),n},this.IsArrStrContain=function(e,t){var n=!1;if(e&&0<e.length)for(var r=0;r<e.length;r++)if(e[r]==t){n=!0;break}return n},this.strJsonToJsonObj=function(e){return new Function("return "+e)()},this.GetListValueByKey=function(e,n){var r=[];return e&&0<e.length&&d(e).each(function(e,t){r.push(t[n])}),r},this.GetListValueByKey2=function(e,n,r){var o=[];return e&&0<e.length&&d(e).each(function(e,t){o.push(u.GetJsonValue(u.GetJsonValue(t,n),r))}),o},this.JsonArrUpdate=function(e,n,r){var o=this,i=[];return e&&0<e.length&&d(e).each(function(e,t){t[n]==r[n]?i.push(o.CombineJson(t,r)):i.push(t)}),i},this.JsonArrBatchUpdate=function(e,o,i,l,a){var s=[];return e&&0<e.length&&d(e).each(function(e,t){var n=t[o];if(-1<l.indexOf(n))for(var r in a)t[r][i]=a[r];s.push(t)}),s},this.JsonArrSingleUpdate=function(e,t,n,r,o,i){var l={},a={};if(e&&0<e.length)for(var s=0;s<e.length;s++){var p=e[s];if(r==p[t]){for(var d in a=JSON.parse(JSON.stringify(p)),o)p[d]||(p[d]={name:d,value:o[d]}),p[d][n]=o[d],d==h.AttrName.ENXFILE_ATTR_OBJNAME&&(p[h.AttrName.ENXFILE_ATTR_NAME][n]=o[d]);l=p;break}}return i&&i(a,l),l},this.JsonArrSingleUpdate2=function(e,t,n,r,o){if(e&&0<e.length)for(var i=0;i<e.length;i++){var l=e[i];if(r==l[t][n]){for(var a in o)l[a][n]=o[a];break}}},this.JsonArrDelete=function(e,n,r){var o=[];return e&&0<e.length&&d(e).each(function(e,t){t[n]!=r&&o.push(t)}),o},this.CombineJson=function(e,t){var n=e;if(t)for(var r in t)n[r]=t[r];return n},this.FilterListByValues=function(e,r,o){var i=[];return e&&0<e.length&&d(e).each(function(e,t){for(var n=0;n<o.length;n++)if(t[r]==o[n]){i.push(t);break}}),i},this.ExceptListByValues=function(e,o,i){var l=[];return e&&0<e.length&&d(e).each(function(e,t){for(var n=!1,r=0;r<i.length;r++)if(t[o]==i[r]){n=!0;break}n||l.push(t)}),l},this.CopyArr=function(e){var n=this,r=[];return e&&0<e.length&&d(e).each(function(e,t){r.push(n.strJsonToJsonObj(d.toJSON(t)))}),r},this.GetListValueByDoubleKey=function(e,n,r){var o=[];return e&&0<e.length&&d(e).each(function(e,t){t=t[n]||{};o.push(t[r]||"")}),o},this.FilterArr=function(e,t,n){var r=[],o=t||"";if(e&&0<e.length)for(var i=0;i<e.length;i++){var l=e[i],a=!1;switch(n){case 0:a=0==l.indexOf(o);break;case 1:a=l.length-o.length==l.lastIndexOf(o);break;case 2:a=o==l}a&&r.push(l)}return r},this.StrArrToJsonList=function(e,t,n){var r=[];if(e&&0<e.length)for(var o=0;o<e.length;o++){var i=e[o],l={};l[t]=i,l[n]=i,r.push(l)}return r},this.Distinct=function(e){for(var t=[],n={},r=0;r<e.length;r++)n[e[r]]||(t.push(e[r]),n[e[r]]=1);return t},this.ArrDelete=function(e,n){var r=[];return e&&0<e.length&&d(e).each(function(e,t){t!=n&&r.push(t)}),r},this.ArrAdd=function(e,t){var n=[];return n.push(t),e&&0<e.length&&(0<=e.indexOf(t)||e.push(t),n=e),n},this.ArrJsonPaged=function(e,t,n,r){var o=[],n=n||0,t=t||0,i=n?n*t:0;if(e.length>i)for(var n=e.length-i,l=t<n?t:n,a=0;a<l;a++)o.push(e[i+a]);return o},this.JsonArrFilterByJson=function(e,l,a,t){var s=t||0,p=[];return e&&0<e.length&&d(e).each(function(e,t){var n,r=!0;for(n in a){var o=u.GetJsonValue(t,n),i=a[n];if("object"==typeof o&&(o=u.GetJsonValue(o,l)),i instanceof Array&&0<i.length)r=r&&-1<i.indexOf(o);else switch(s){case 0:r=r&&0==o.indexOf(i);break;case 1:r=r&&o==i;break;case 2:r=r&&o.length-i.length==o.lastIndexOf(i);break;case 3:r=r&&0<=o.indexOf(i)}if(!r)break}r&&p.push(t)}),p},this.GetStrValue=function(e,t){return e[t]||""},this.GetJsonValue=function(e,t){return e[t]||{}},this.IsJsonObj=function(e){return"object"==typeof e&&"[object object]"==Object.prototype.toString.call(e).toLowerCase()&&!e.length}};return{enxHelper:e,enxConstField:h,jsonHelper:u}}),function(e,t){"use strict";"function"==typeof define&&define.amd?define(["jquery","enxHelper"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("jquery"),require("enxHelper")):e.envEditor=t(e.jQuery,e.enxHelper)}(this,function(u,E){var i="undefined"!=typeof window?window.document:{},o={root:"static/plugins/envEditor/",imageDir:"images/",dataDir:"data/",enxId:null};function n(){var d=this;this.Property=new function(){this.ERRCODE_SUCCESS="0x0000",this.DataList=[],this.LstNodeJson=[],this.LstLinkJson=[],this.BusyPortId=[],this.LstPortJson=[],this.ElementId="",this.Element={},this.SelectModelType=E.enxHelper.ModelType.Ne,this.CurrentUser="",this.DefaultPDU="SYSTEM",this.CurrentPDU=this.DefaultPDU,this.WebsvcSuffix=".asmx",this.FileAfter=".enx",this.EnxId=E.enxHelper.CreateNewGuid(),this.PostUrl=new function(){this.GetById="",this.UpdateById=""},this.GraphPlug={},this.TopoNode={},this.NetworkJson=[],this.SelectOptionValues={vmFlag:["","Fenix_GTR_4U4G100G_01","Fenix_vNE_sFTP_Tester_8U8G90G_01"],network:["","Base1","Base2","Fabric1","Fabric2","OM","External1","External2","External3","External4","External5","External6","ExternalN"],internal_external:["","InternalPort","ExternalPort"],virtual_real:["Virtual","Real"]},this.FileName="",this.ArrTestBedName=[]},this.SetData=function(e){this.ConstInfo.Reset(),this.Property.DataList=e,this.Property.TopoNode=E.jsonHelper.GetJsonByKey(e,E.enxHelper.Field.BigType,E.enxHelper.ModelType.Env),this.Property.LstNodeJson=E.jsonHelper.FilterListByValues(e,E.enxHelper.Field.IsTopDevice,[E.enxConstField.BoolStr.Yes]),this.Property.LstLinkJson=E.jsonHelper.FilterListByValues(e,E.enxHelper.Field.BigType,[E.enxHelper.ModelType.Link]),d.Property.BusyPortId=[],u.each(d.Property.LstLinkJson,function(e,t){var n=E.jsonHelper.GetStrValue(t[E.enxConstField.AttrName.ENXFILE_ATTR_SOURCEDEVICEID],E.enxConstField.AttrName.ENXFILE_ATTR_VALUE),t=E.jsonHelper.GetStrValue(t[E.enxConstField.AttrName.ENXFILE_ATTR_TARGETDEVICEID],E.enxConstField.AttrName.ENXFILE_ATTR_VALUE);d.Property.BusyPortId.push(n),d.Property.BusyPortId.push(t)}),this.Property.LstPortJson=E.jsonHelper.FilterListByValues(e,E.enxHelper.Field.BigType,[E.enxHelper.ModelType.Port]),this.GraphEditor.Init()},this.GetObjectNameCache=function(){var r={};return d.Property.DataList&&0<d.Property.DataList.length&&u(d.Property.DataList).each(function(e,t){var n=E.jsonHelper.GetJsonValue(E.jsonHelper.GetJsonValue(t,E.enxConstField.AttrName.ENXFILE_ATTR_OBJNAME),E.enxConstField.AttrName.ENXFILE_ATTR_VALUE),t=t[E.enxHelper.Field.ID];r[n]=t}),r},this.Init=function(e){var t=E.enxHelper.GetQueryString(d.ConstInfo.QueryStringParam.pdu),n=E.enxHelper.GetQueryString(d.ConstInfo.QueryStringParam.user),r=E.enxHelper.GetQueryString(d.ConstInfo.QueryStringParam.enxId);d.Property.CurrentPDU=t||d.Property.DefaultPDU;t=d.PduRelUrl[d.Property.CurrentPDU]||d.PduRelUrl[d.Property.DefaultPDU];-1==t.indexOf(d.Property.WebsvcSuffix)?(d.Property.PostUrl.GetById=t+d.ConstInfo.QueryMethod.GetEnvContentByIdNew,d.Property.PostUrl.UpdateById=t+d.ConstInfo.QueryMethod.UpdateDataByIdNew):(d.Property.PostUrl.GetById=t+d.ConstInfo.QueryMethod.GetEnxContentById,d.Property.PostUrl.UpdateById=t+d.ConstInfo.QueryMethod.UpdateDataById),n&&(d.Property.CurrentUser=n),r&&(d.Property.EnxId=r,this.GetEnxContentByID(r)),u(i.body).addClass("envEditor"),this.OptionParam=u.extend({},o,e),d.SetData([]),this.loadLocalEnx()},this.loadLocalEnx=function(){var e=u(".EplugGraphEditorRightContainer"),t=this.OptionParam;e.showLoader(),u.get(t.root+t.dataDir+t.enxId+".enx",function(e){d.SetData(E.enxHelper.EnxToLstJson(e))}).always(function(){e.hideLoader()})},this.toggleRightContainer=function(e){function t(e,t,n,r,o){a.css({"padding-right":r+p}),l.css("width",e),s.css("display",o),i[t]("left").attr("title",n)}var i=u(".EplugGraphRightToggle"),l=u(".EplugGraphEditorResource"),a=u(".EplugGraphEditorRightContainer"),s=u(".EplugGraphEditorRightTop"),n=i.outerWidth(),p=560-n,r=i.hasClass("left");e?r&&t(560,"removeClass","Close","+=","block"):r||t(n,"addClass","Open","-=","none")},this.GetEnxContentByID=function(e){var r=[],o="",t=d.Property.CurrentUser,n="GET",i="";-1==d.Property.PostUrl.GetById.indexOf(d.Property.WebsvcSuffix)?d.Property.PostUrl.GetById=E.enxHelper.Format(d.Property.PostUrl.GetById,e):(n="POST",i=JSON.stringify({user:t,enxId:e}));var e=d.Property.PostUrl.GetById,i=i,t=JSON.stringify({"X-Auth-UserID":t}),l=u(".EplugGraphEditorRightContainer");l.showLoader(),this.RequestService(n,e,i,t,function(e){l.hideLoader();var t,n="";e&&e.resMessage&&e.errcode==d.Property.ERRCODE_SUCCESS?(t=JSON.parse(e.resMessage),-1==d.Property.PostUrl.GetById.indexOf(d.Property.WebsvcSuffix)?t&&t.content&&(o=t.content,d.Property.FileName=t.filename,u("#txtTopoLimit").val(t.topolimit)):t&&t.d&&((t=JSON.parse(t.d).result)&&(o=t.enx,d.Property.FileName=t.filename))):n=e.errcode,n&&toastr.error(n),o&&(r=E.enxHelper.EnxToLstJson(o))},function(e,t,n){l.hideLoader();var r=e.statusText;-1==d.Property.PostUrl.GetById.indexOf(d.Property.WebsvcSuffix)&&e.responseText&&(r=r+"\r\n"+(JSON.parse(e.responseText||"{}").message||"")),toastr.error(r)},function(e){d.SetData(r)})},this.GetEnxContent=function(){u.each(d.Property.LstNodeJson,function(e,t){var n=t[E.enxHelper.Field.ID],r=t[E.enxHelper.Field.BigType],n=d.Property.GraphPlug.GetCellsByFieldValue(r,d.Property.GraphPlug.ConstInfo.AttrName.ID,n),n=E.enxHelper.AttrParameter(E.enxConstField.AttrName.ENXFILE_ATTR_POSITION,d.Property.GraphPlug.Translater.BondToString(n));t[E.enxConstField.AttrName.ENXFILE_ATTR_POSITION]=n});var e=E.enxHelper.LstJsonToEnx(d.Property.DataList);return e.replace(new RegExp("&lt;","gm"),"<").replace(new RegExp("&gt;","gm"),">").replace(new RegExp("★","gm"),"&quot;").replace(new RegExp("♣","gm"),"&amp;").replace(new RegExp("◀","gm"),"&lt;").replace(new RegExp("▶","gm"),"&gt;")},this.GetPostData=function(){var e=this.GetEnxContent(),t=d.Property.CurrentUser,n=u("#txtTopoLimit").val(),r=d.Property.FileName||d.Property.EnxId+d.Property.FileAfter;return-1==d.Property.PostUrl.UpdateById.indexOf(d.Property.WebsvcSuffix)?{id:d.Property.EnxId,content:e,filename:r,userid:t,topolimit:n,testbedname:"",testbedcontent:""}:(n=d.Property.GraphPlug.GetImageUrl(),{user:d.Property.CurrentUser,enxId:d.Property.EnxId,enxContent:e,enxImageUrl:n,fileName:r})},this.SaveData=function(o){var e,t=d.Property.PostUrl.UpdateById,n=this.GetPostData();n&&n.content&&(e={"X-Auth-UserID":d.Property.CurrentUser},this.RequestService("POST",t,JSON.stringify(n),JSON.stringify(e),function(e){var t,n="";e&&e.resMessage&&e.errcode==d.Property.ERRCODE_SUCCESS?(t=JSON.parse(e.resMessage),-1==d.Property.PostUrl.UpdateById.indexOf(d.Property.WebsvcSuffix)?t.result&&"success"==t.result?(d.OpenNewUrl(),o&&toastr.success("Save successfully!")):n=t.message:(t=JSON.parse(t.d)).errcode&&(n=t.errcode)):n=e.errcode,o&&n&&toastr.error(n)},function(e,t,n){var r=e.statusText;-1==d.Property.PostUrl.UpdateById.indexOf(d.Property.WebsvcSuffix)&&e.responseText&&(r=r+"\r\n"+(JSON.parse(e.responseText||"{}").message||"")),o&&alertMsg&&toastr.error(r)}))},this.RequestService=function(e,t,n,r,o,i,l){var a=new FormData;a.append("req_type",e),a.append("service_addr",t),a.append("req_content",escape(n)),a.append("headerSet",escape(r)),u.ajax({type:"POST",url:"/Home/RequestService",data:a,dataType:"json",processData:!1,contentType:!1,success:o,error:i,complete:l})},this.ExportFile=function(){xmlContent=this.GetEnxContent();var e=new FormData;e.append("user",d.Property.CurrentUser),e.append("enxId",d.Property.EnxId),e.append("enxContent",escape(xmlContent)),u.ajax({type:"POST",url:"/Home/ExportEnxFile",data:e,dataType:"json",processData:!1,contentType:!1,success:function(e){e&&e.url&&d.OpenNewPage(e.url,void 0,!0),e&&e.errcode&&toastr.error(e.errcode)}})},this.ViewText=function(){xmlContent=this.GetEnxContent();var e=new FormData;e.append("enxId",d.Property.EnxId),e.append("enxContent",escape(xmlContent)),u.ajax({type:"POST",url:"/Home/ViewText",data:e,dataType:"json",processData:!1,contentType:!1,success:function(e){e&&u("#xmpViewText").text(e.content||e.errcode),u("#modalViewText").modal()}})},this.OpenNewPage=function(e,t,n){null!=t&&"object"==typeof t&&(e=e+"?"+u.param(t));t=null!=n?"_parent":"_blank";u.browser&&u.browser.mozilla?window.location=e:((n=i.createElement("a")).href=e,n.target=t,n.style.display="none",i.body.appendChild(n),n.click(),i.body.removeChild(n))},this.OpenNewUrl=function(){var e=d.Property.EnxId,t=(window.location.host,window.location.search.substr(1)),n=[],r=d.ConstInfo.QueryStringParam.enxId,o=r+"="+e;if(t){if(n=t.split("&"),t.indexOf(r)<0)n.push(o);else for(var i=0;i<n.length;i++)if(0<=n[i].indexOf(r)){n[i]=o;break}o=n.join("&")}window.location.search=o},this.GetElement=function(e){return this.Property.Element.find(e)},this.HtmlEditor=new function(){this.GetModelField=function(e,t){var n=d.ConstInfo.AvailableFiled[e];return d.ConstInfo.IsFirstInitAvailField[e]&&!t?this.InitAvailField(e):n},this.InitAvailField=function(e){var t=this.GetModelUnAvailField(e),n=this.GetModelField(e,!0),r=this.GetFirstModelEntity(e),o=E.jsonHelper.GetJsonAllValue(E.enxHelper.Field);d.ConstInfo.IsFirstInitAvailField[e]=!1;var i,l,a=E.jsonHelper.IsJsonObj(r);for(l in r)"string"==typeof(i=a?l:r[l])&&o.indexOf(i)<0&&t.indexOf(i)<0&&n.push(i);return n},this.GetFirstModelEntity=function(e){return d.ConstInfo.DefaultAvailField[e]},this.GetModelUnAvailField=function(e){return d.ConstInfo.UnAvailableFiled[e]}},this.GraphEditor=new function(){this.Init=function(){E.jsonHelper.IsEmptyJson(d.Property.GraphPlug)?d.Property.GraphPlug=new e(d):(d.Property.GraphPlug.ClearChildren(),d.Property.GraphPlug.RenderData())}},this.OptionParam={},this.PduRelUrl={SYSTEM:"http://superlab.huawei.com:7996/",SYSTEM_TEST:"http://localhost:50038/"},this.GetSpecialField=function(e){var t=[];return t=e==E.enxHelper.ModelType.Link?E.jsonHelper.GetJsonAllKey(d.ConstInfo.SpecialFieldDic):t},this.GetDisplayFieldName=function(e){var t=e;return t=d.ConstInfo.SpecialFieldDic[e]?d.ConstInfo.SpecialFieldDic[e]:t},this.ConstInfo=new function(){this.Reset=function(){this.IsFirstInitAvailField.Ne=!0,this.IsFirstInitAvailField.Tester=!0,this.IsFirstInitAvailField.Dev=!0,this.IsFirstInitAvailField.Atm=!0,this.IsFirstInitAvailField.Sdh=!0,this.IsFirstInitAvailField.Eth=!0,this.IsFirstInitAvailField.Board=!0,this.IsFirstInitAvailField.SubBoard=!0,this.IsFirstInitAvailField.Link=!0,this.IsFirstInitAvailField.Port=!0,this.IsFirstInitAvailField.Network=!0,this.IsFirstInitAvailField.Sftp=!0,this.IsFirstInitAvailField.Agent=!0,this.IsFirstInitAvailField.VM=!0,this.AvailableFiled.Ne=["roler"],this.Sdh=[],this.Atm=[],this.Eth=[],this.Tester=[],this.Dev=[],this.AvailableFiled.Board=[],this.AvailableFiled.SubBoard=[],this.AvailableFiled.Link=[],this.AvailableFiled.Port=[],this.Network=[],this.Sftp=[],this.Agent=[],this.AvailableFiled.VM=[]},this.REG_IP=new RegExp(/^((25[0-5]|2[0-4]\d|[01]?\d\d?)($|(?!\.$)\.)){4}$/),this.IPINPUTCLASS="EplugIpInput",this.IPINPUTINCORRECTCLASS="EplugIpInputIncorrect",this.IPINPUTINCORRECTTIP="Incorrect:",this.TableDataCheckId="data-checkIds",this.IDSelectorSingal="#",this.ClassSelectorSingal=".",this.IsFirstInitAvailField=new function(){this.Ne=!0,this.Sdh=!0,this.Atm=!0,this.Eth=!0,this.Tester=!0,this.Dev=!0,this.Board=!0,this.SubBoard=!0,this.Link=!0,this.Port=!0,this.Network=!0,this.Sftp=!0,this.Agent=!0,this.VM=!0},this.AvailableFiled=new function(){this.Ne=["roler"],this.Sdh=[],this.Atm=[],this.Eth=[],this.Tester=[],this.Dev=[],this.Board=[],this.SubBoard=[],this.Link=[],this.Port=[],this.Network=[],this.Sftp=[],this.Agent=[],this.VM=[]},this.DefaultAvailField=new function(){this.CommonAvailField=["objname","name","ip","type","version","alias","caption","is_topo","remark"],this.Ne=this.CommonAvailField.concat(["id","console","mask","username","password","ptp","vender","virtual_real","port","cmts_port","cmts_type","olt_version","sub_ip"]),this.Atm=this.CommonAvailField,this.Sdh=this.CommonAvailField,this.Eth=this.CommonAvailField.concat(["actor","bid","sbid","pid","connect_type","engrossstate","groupip","id","mac","username","password","port","portnum","ptp","realNEId","realtype","submask","vender"]),this.Board=this.CommonAvailField.concat(["angle","bid","engrossstate","username","password","portnum","realNEId","slot","virtual_real"]),this.SubBoard=this.CommonAvailField.concat(["bid","sbid","engrossstate","username","password","portnum","realNEId","submask","virtual_real"]),this.Link=this.CommonAvailField.concat(["sourcetopdevicename","sourcedeviceid","targettopdevicename","targetdeviceid","connect_type","direction","parent","cidr","start_ip","end_ip"]),this.Port=this.CommonAvailField.concat(["bid","sbid","pid","shape","submask","interface","host_id","internal_external","virtual_real"]),this.Network=this.CommonAvailField.concat(["cidr","start_ip","end_ip"]),this.VM=this.CommonAvailField.concat(["username","password","vmFlag","cpu_memory","hardDisk","mirror","virtual_real"]),this.Sftp=this.VM,this.Agent=this.VM,this.Tester=this.VM,this.Dev=this.VM},this.UnAvailableFiled=new function(){this.CommonUnAvailField=["name","guid","shape","position","class","fullclass"],this.Ne=this.CommonUnAvailField.concat(["id","bid","connect_type","mac","pid","port","portnum"]),this.Tester=this.CommonUnAvailField,this.Dev=this.CommonUnAvailField,this.Sdh=this.CommonUnAvailField,this.Atm=this.CommonUnAvailField,this.Eth=this.CommonUnAvailField,this.Board=this.CommonUnAvailField,this.SubBoard=this.CommonUnAvailField.concat(["bid"]),this.Link=this.CommonUnAvailField.concat(["dst_port","src_port"]),this.Port=this.CommonUnAvailField,this.Network=this.CommonUnAvailField,this.Sftp=this.CommonUnAvailField,this.Agent=this.CommonUnAvailField,this.VM=this.CommonUnAvailField},this.MinPageSize=10,this.CheckBoxTDFieldName="checkboxelem",this.OperationTDFieldName="operationelem",this.CombineRepalceSingal="(0*\\[[1-9]\\d*\\-[1-9]\\d*\\]|0*[1-9]\\d*\\+|0*\\*)(\\([1-9]\\d*\\))?",this.AllReplaceSingal="\\*",this.NumberRegionSingal="[1-9]\\d*",this.OccupiedPlace="0+",this.RegionReplaceSingal="\\[[1-9]\\d*\\-[1-9]\\d*\\]",this.NumAddSingal="+",this.NumAddReplaceSingal="[1-9]\\d*\\+",this.RegGM="gm",this.AddStep="(\\([1-9]\\d*\\))",this.AddSelfType={NumberAdd:"NumberAdd",Region:"Region",AutoAdd:"AutoAdd"},this.SpecialFieldDic={sourcedeviceid:"src_port",targetdeviceid:"dst_port"},this.SelectField=["vmFlag","network","internal_external","virtual_real"],this.NoEditField=["sourcetopdevicename","targettopdevicename"],this.NoEditTdClass="EPlugNoEditTd",this.QueryStringParam=new function(){this.pdu="pdu",this.user="user",this.enxId="enxId"},this.QueryMethod=new function(){this.GetEnxContentById="GetEnxContentById",this.GetEnvContentByIdNew="api/editor/v1/content/{0}",this.UpdateDataById="UpdateEnxContent",this.UpdateDataByIdNew="api/editor/v1/enx"},this.RepeatedSingal="(1)",this.RepeatedElemtClass="EPlugRepeatName",this.TIME_INTERVAL=null},this.SetNodeAttr=function(e,t,n,r){for(var o=this.GetLstByModelType(e),i=0;i<o.length;i++)if(o[i][E.enxHelper.Field.ID]==t){o[i][n]=r;break}},this.DeleteNodeAttr=function(e,t,n){for(var r=this.GetLstByModelType(e),o=0;o<r.length;o++)if(r[o][E.enxHelper.Field.ID]==t){delete r[o][n];break}},this.GetLstByModelType=function(e){var t=[];switch(e){case E.enxHelper.ModelType.Ne:t=d.Property.LstNodeJson;break;case E.enxHelper.ModelType.Link:t=d.Property.LstLinkJson;break;case E.enxHelper.ModelType.Port:t=d.Property.LstPortJson}return t},this.CreateModel=function(r,e,o,t,n,i){var l={};l[E.enxHelper.Field.BigType]=r,n=n||E.enxHelper.CreateNewGuid(),l[E.enxHelper.Field.ID]=n,e&&(l[E.enxHelper.Field.ParentGID]=e);n=E.enxHelper.AttrParameter(E.enxConstField.AttrName.ENXFILE_ATTR_GUID,n);l[E.enxConstField.AttrName.ENXFILE_ATTR_GUID]=n;var a,n=d.ConstInfo.DefaultAvailField[r],s=E.enxHelper.GlobalVar.ElemntIndex[r];n&&(a=d.ConstInfo.SelectField,u.each(n,function(e,t){var n="";t!=E.enxConstField.AttrName.ENXFILE_ATTR_OBJNAME&&t!=E.enxConstField.AttrName.ENXFILE_ATTR_NAME||(n=d.Property.GraphPlug.ConstInfo.ElemntNamePre[r]+s,!o||r!=E.enxHelper.ModelType.Board&&r!=E.enxHelper.ModelType.SubBoard&&r!=E.enxHelper.ModelType.Port&&r!=E.enxHelper.ModelType.VM||(n=o+E.enxConstField.NameSeparate+n)),-1<a.indexOf(t)&&(n=d.Property.SelectOptionValues[t][0]),E.jsonHelper.IsJsonObj(i)&&i[t]&&(n=i[t]);n=E.enxHelper.AttrParameter(t,n);l[t]=n})),E.enxHelper.GlobalVar.ElemntIndex[r]=s+1;var p=t?t+E.enxConstField.ClassSeparate:"";switch(r){case E.enxHelper.ModelType.Ne:case E.enxHelper.ModelType.Sftp:case E.enxHelper.ModelType.Agent:l[E.enxHelper.Field.IsTopDevice]=E.enxConstField.BoolStr.Yes,l[E.enxConstField.AttrName.ENXFILE_ATTR_CLASS]=E.enxHelper.AttrParameter(E.enxConstField.AttrName.ENXFILE_ATTR_CLASS,r),l[E.enxConstField.AttrName.ENXFILE_ATTR_FULLCLASS]=E.enxHelper.AttrParameter(E.enxConstField.AttrName.ENXFILE_ATTR_FULLCLASS,r),d.Property.LstNodeJson.push(l);break;case E.enxHelper.ModelType.Network:l[E.enxHelper.Field.IsTopDevice]=e&&"Env"!=t?E.enxConstField.BoolStr.No:E.enxConstField.BoolStr.Yes,l[E.enxConstField.AttrName.ENXFILE_ATTR_CLASS]=E.enxHelper.AttrParameter(E.enxConstField.AttrName.ENXFILE_ATTR_CLASS,r),l[E.enxConstField.AttrName.ENXFILE_ATTR_FULLCLASS]=E.enxHelper.AttrParameter(E.enxConstField.AttrName.ENXFILE_ATTR_FULLCLASS,r),d.Property.LstNodeJson.push(l);break;case E.enxHelper.ModelType.Tester:l[E.enxHelper.Field.IsTopDevice]=E.enxConstField.BoolStr.Yes,l[E.enxConstField.AttrName.ENXFILE_ATTR_CLASS]=E.enxHelper.AttrParameter(E.enxConstField.AttrName.ENXFILE_ATTR_CLASS,E.enxConstField.SpecialName.ENXFILE_SPECIAL_TESTERTYPE),l[E.enxConstField.AttrName.ENXFILE_ATTR_FULLCLASS]=E.enxHelper.AttrParameter(E.enxConstField.AttrName.ENXFILE_ATTR_FULLCLASS,E.enxConstField.SpecialName.ENXFILE_SPECIAL_TESTERTYPE),d.Property.LstNodeJson.push(l);break;case E.enxHelper.ModelType.Dev:l[E.enxHelper.Field.IsTopDevice]=E.enxConstField.BoolStr.Yes,l[E.enxConstField.AttrName.ENXFILE_ATTR_CLASS]=E.enxHelper.AttrParameter(E.enxConstField.AttrName.ENXFILE_ATTR_CLASS,E.enxConstField.SpecialName.ENXFILE_SPECIAL_DEVTYPE),l[E.enxConstField.AttrName.ENXFILE_ATTR_FULLCLASS]=E.enxHelper.AttrParameter(E.enxConstField.AttrName.ENXFILE_ATTR_FULLCLASS,E.enxConstField.SpecialName.ENXFILE_SPECIAL_DEVTYPE),d.Property.LstNodeJson.push(l);break;case E.enxHelper.ModelType.Atm:l[E.enxHelper.Field.IsTopDevice]=E.enxConstField.BoolStr.Yes,l[E.enxConstField.AttrName.ENXFILE_ATTR_CLASS]=E.enxHelper.AttrParameter(E.enxConstField.AttrName.ENXFILE_ATTR_CLASS,E.enxConstField.SpecialName.ENXFILE_SPECIAL_UNKOWNTYPEATM),l[E.enxConstField.AttrName.ENXFILE_ATTR_FULLCLASS]=E.enxHelper.AttrParameter(E.enxConstField.AttrName.ENXFILE_ATTR_FULLCLASS,E.enxConstField.SpecialName.ENXFILE_SPECIAL_UNKOWNTYPEATM),d.Property.LstNodeJson.push(l);break;case E.enxHelper.ModelType.Sdh:l[E.enxHelper.Field.IsTopDevice]=E.enxConstField.BoolStr.Yes,l[E.enxConstField.AttrName.ENXFILE_ATTR_CLASS]=E.enxHelper.AttrParameter(E.enxConstField.AttrName.ENXFILE_ATTR_CLASS,E.enxConstField.SpecialName.ENXFILE_SPECIAL_UNKOWNTYPESDH),l[E.enxConstField.AttrName.ENXFILE_ATTR_FULLCLASS]=E.enxHelper.AttrParameter(E.enxConstField.AttrName.ENXFILE_ATTR_FULLCLASS,E.enxConstField.SpecialName.ENXFILE_SPECIAL_UNKOWNTYPESDH),d.Property.LstNodeJson.push(l);break;case E.enxHelper.ModelType.Eth:l[E.enxHelper.Field.IsTopDevice]=E.enxConstField.BoolStr.Yes,l[E.enxConstField.AttrName.ENXFILE_ATTR_CLASS]=E.enxHelper.AttrParameter(E.enxConstField.AttrName.ENXFILE_ATTR_CLASS,E.enxConstField.SpecialName.ENXFILE_SPECIAL_UNKOWNTYPEETH),l[E.enxConstField.AttrName.ENXFILE_ATTR_FULLCLASS]=E.enxHelper.AttrParameter(E.enxConstField.AttrName.ENXFILE_ATTR_FULLCLASS,E.enxConstField.SpecialName.ENXFILE_SPECIAL_UNKOWNTYPEETH),d.Property.LstNodeJson.push(l);break;case E.enxHelper.ModelType.Link:l[E.enxHelper.Field.IsTopDevice]=E.enxConstField.BoolStr.No,l[E.enxConstField.AttrName.ENXFILE_ATTR_CLASS]=E.enxHelper.AttrParameter(E.enxConstField.AttrName.ENXFILE_ATTR_CLASS,E.enxConstField.SpecialName.ENXFILE_SPECIAL_UNKOWNTYPECONNECT),d.Property.LstLinkJson.push(l);break;case E.enxHelper.ModelType.Board:case E.enxHelper.ModelType.SubBoard:case E.enxHelper.ModelType.VM:l[E.enxHelper.Field.IsTopDevice]=E.enxConstField.BoolStr.No,l[E.enxConstField.AttrName.ENXFILE_ATTR_CLASS]=E.enxHelper.AttrParameter(E.enxConstField.AttrName.ENXFILE_ATTR_CLASS,r),l[E.enxConstField.AttrName.ENXFILE_ATTR_FULLCLASS]=E.enxHelper.AttrParameter(E.enxConstField.AttrName.ENXFILE_ATTR_FULLCLASS,p+r);case E.enxHelper.ModelType.Port:l[E.enxHelper.Field.IsTopDevice]=E.enxConstField.BoolStr.No,l[E.enxConstField.AttrName.ENXFILE_ATTR_CLASS]=E.enxHelper.AttrParameter(E.enxConstField.AttrName.ENXFILE_ATTR_CLASS,r),l[E.enxConstField.AttrName.ENXFILE_ATTR_FULLCLASS]=E.enxHelper.AttrParameter(E.enxConstField.AttrName.ENXFILE_ATTR_FULLCLASS,p+r),d.Property.LstPortJson.push(l)}return d.Property.DataList.push(l),l},this.CopyModel=function(e,t,r,n){var o=JSON.parse(JSON.stringify(e)),i=E.enxHelper.CreateNewGuid(),l=o[E.enxHelper.Field.ID];o[E.enxHelper.Field.ID]=i;var a=o[E.enxHelper.Field.BigType];t&&(o[E.enxHelper.Field.ParentGID]=t);e=E.enxHelper.AttrParameter(E.enxConstField.AttrName.ENXFILE_ATTR_GUID,i);o[E.enxConstField.AttrName.ENXFILE_ATTR_GUID]=e;var t=[E.enxConstField.AttrName.ENXFILE_ATTR_OBJNAME,E.enxConstField.AttrName.ENXFILE_ATTR_NAME],e=E.enxHelper.GlobalVar.ElemntIndex[a],s=d.Property.GraphPlug.ConstInfo.ElemntNamePre[a]+e;switch(u.each(t,function(e,t){var n=s;!r||a!=E.enxHelper.ModelType.Board&&a!=E.enxHelper.ModelType.SubBoard&&a!=E.enxHelper.ModelType.Port&&a!=E.enxHelper.ModelType.VM||(n=r+E.enxConstField.NameSeparate+s),o[t][E.enxConstField.AttrName.ENXFILE_ATTR_VALUE]=n}),E.enxHelper.GlobalVar.ElemntIndex[a]=e+1,a){case E.enxHelper.ModelType.Ne:case E.enxHelper.ModelType.Tester:case E.enxHelper.ModelType.Dev:case E.enxHelper.ModelType.Atm:case E.enxHelper.ModelType.Sdh:case E.enxHelper.ModelType.Eth:d.Property.LstNodeJson.push(o);break;case E.enxHelper.ModelType.Link:d.Property.LstLinkJson.push(o);break;case E.enxHelper.ModelType.Port:d.Property.LstPortJson.push(o);break;default:d.Property.LstNodeJson.push(o)}d.Property.DataList.push(o);var l=E.jsonHelper.FilterListByValues(d.Property.DataList,E.enxHelper.Field.ParentGID,[l]),p=[o];return u.each(l,function(e,t){t=d.CopyModel(t,i,s,n);p=p.concat(t)}),p},this.GetLinkByPortId=function(e){for(var t={},n=0;n<d.Property.LstLinkJson.length;n++){var r=d.Property.LstLinkJson[n];if(r.sourcedeviceid.value==e||r.targetdeviceid.value==e){t=r;break}}return t},this.RemoveModelByParentId=function(e,n){e=this.RemoveModel(E.enxHelper.Field.ParentGID,e);n&&u.each(e,function(e,t){d.RemoveModelByParentId(t,n)})},this.RemoveModel=function(r,o){var i=[],l=[];return u.each(d.Property.DataList,function(e,t){var n=t[r];(n="object"==typeof n?E.jsonHelper.GetStrValue(n,E.enxConstField.AttrName.ENXFILE_ATTR_VALUE):n)!=o?i.push(t):(d.RemoveModelRelaHandler(t),l.push(E.jsonHelper.GetStrValue(t,E.enxHelper.Field.ID)))}),d.Property.DataList=i,l},this.RemoveModelRelaHandler=function(e){var t=e[E.enxHelper.Field.ID];switch(e[E.enxHelper.Field.BigType]){case E.enxHelper.ModelType.Ne:case E.enxHelper.ModelType.Tester:case E.enxHelper.ModelType.Dev:case E.enxHelper.ModelType.Atm:case E.enxHelper.ModelType.Sdh:case E.enxHelper.ModelType.Eth:d.Property.LstNodeJson=d.JsonArrDelete(d.Property.LstNodeJson,E.enxHelper.Field.ID,t);break;case E.enxHelper.ModelType.Link:d.Property.LstLinkJson=d.JsonArrDelete(d.Property.LstLinkJson,E.enxHelper.Field.ID,t);var n=E.jsonHelper.GetStrValue(e[E.enxConstField.AttrName.ENXFILE_ATTR_SOURCEDEVICEID],E.enxConstField.AttrName.ENXFILE_ATTR_VALUE),r=E.jsonHelper.GetStrValue(e[E.enxConstField.AttrName.ENXFILE_ATTR_TARGETDEVICEID],E.enxConstField.AttrName.ENXFILE_ATTR_VALUE);d.Property.BusyPortId.splice(d.Property.BusyPortId.indexOf(n),1),d.Property.BusyPortId.splice(d.Property.BusyPortId.indexOf(r),1);break;case E.enxHelper.ModelType.Port:d.Property.LstPortJson=d.JsonArrDelete(d.Property.LstPortJson,E.enxHelper.Field.ID,t),-1<d.Property.BusyPortId.indexOf(t)&&(r=d.GetLinkByPortId(t),d.RemoveModel(E.enxHelper.Field.ID,E.jsonHelper.GetStrValue(r,E.enxHelper.Field.ID)))}},this.GetChildrens=function(n,r){var o=[];return u.each(d.Property.DataList,function(e,t){t[E.enxHelper.Field.ParentGID]==n&&(o.push(t),r)&&(t=d.GetChildrens(t[E.enxHelper.Field.ID],r),o=o.concat(t))}),o},this.JsonArrDelete=function(e,r,o){var i=[];return u.each(e,function(e,t){var n=t[r];(n="object"==typeof n?E.jsonHelper.GetStrValue(n,E.enxConstField.AttrName.ENXFILE_ATTR_VALUE):n)!=o&&i.push(t)}),i}}function e(h){var d=this,o=null;this.Property=new function(){this.CoreGraph={},this.Contain={},this.SelectedVertexId=[],this.SelectedLinkId=[],this.LinkGroupIndex=1,this.AssistantGraph={},this.Editor={}},this.Init=function(){var e,t;mxClient.isBrowserSupported()?(e=this.Property.Contain=i.getElementById("EplugGraphEditorContainer"),t=this.Property.Editor=new mxEditor,(this.Property.CoreGraph=t.graph).init(e),this.BasicFixSet(),this.RenderData(),this.BindEventForMenu(),this.BindEvent(),this.InitPopMenu(),this.SubGraph.Init(),this.PropertyPanel.Init()):mxUtils.error("Browser is not supported!",200,!1)},this.GroupLink=function(e){var t=this.GetAllLink(d.Property.CoreGraph),a=E.jsonHelper.FilterListByValues(t,this.ConstInfo.AttrName.ID,e),s=[];u.each(a,function(e,n){var r,o,i,l;s.indexOf(n.id)<0&&(s.push(n.id),r=n.source.id,o=n.target.id,i=[],l=n.group&&n.data.group.groupshow,u.each(a,function(e,t){t.id!=n.id&&(t.source.id==r&&t.target.id==o||t.target.id==r&&t.source.id==o)&&(l=l||t.group&&t.data.group.groupshow,i.push(t),s.push(t.id))}),l||d.CombineLinkToGroup(n,i,!1))})},this.SubGraph=new function(){this.Graph={},this.Container={},this.EditGraphCell={};var p=this,r=null;function t(e,t){this.canSelectNode=null==e||e,this.canMoveVertet=null==t||t}this.Init=function(){p.Container=i.getElementById("EplugGraphEditorSubEditor"),p.Graph=new mxGraph(this.Container),p.BasicFixSet(),p.BindEvent(),p.ConfigureStylesheet(),p.InitPopMenu();var t=p.Graph.isCellMovable;p.Graph.isCellMovable=function(e){return t.apply(this,arguments)&&r.canMoveVertet};var n=p.Graph.isCellSelectable;p.Graph.isCellSelectable=function(e){return!(p.EditGraphCell&&p.EditGraphCell.edge&&!r.canSelectNode&&e.vertex)&&n.apply(this,arguments)}},this.BasicFixSet=function(){this.Graph.cellsResizable=!1,mxConstants.ENTITY_SEGMENT=20,this.Graph.cellsEditable=!1,this.Graph.edgeLabelsMovable=!1,this.Graph.allowDanglingEdges=!1,this.Graph.allowLoops=!1,this.Graph.setConnectable(!0),this.Graph.setDropEnabled(!0),this.Graph.setTooltips(!0),this.Graph.getTooltipForCell=function(e){return e.objname||e.value},this.Graph.collapseToPreferredSize=!1,this.Graph.constrainChildren=!1,this.Graph.cellsSelectable=!0,this.Graph.extendParentsOnAdd=!1,this.Graph.extendParents=!1,this.Graph.border=10,this.Graph.keepEdgesInForeground=!0;var t=new mxStackLayout(this.Graph,!0);t.border=this.Graph.border,t.marginBottom=-10,new mxLayoutManager(this.Graph).getLayout=function(e){return e.collapsed?null:(e.parent!=p.Graph.model.root?(t.resizeParent=!0,t.horizontal=!1,t.spacing=10,t.x0=15):(t.resizeParent=!0,t.horizontal=!0,t.spacing=120,t.x0=0),t)},mxConstants.VERTEX_SELECTION_COLOR="#87CEEB",mxConstants.VERTEX_SELECTION_STROKEWIDTH=1.3,mxConstants.VERTEX_SELECTION_DASHED=!1,mxConstants.EDGE_SELECTION_STROKEWIDTH=1.3,mxConstants.HIGHLIGHT_STROKEWIDTH=1.3,mxEvent.disableContextMenu(this.Container),new mxCellTracker(this.Graph,"#87CEEB"),mxConstants.DROP_TARGET_COLOR="#87CEEB",mxConstants.CONNECT_HANDLE_FILLCOLOR="#87CEEB",mxConstants.HANDLE_STROKECOLOR="#87CEEB",mxRectangleShape.prototype.crisp=!0,mxGraphHandler.prototype.guidesEnabled=!0,mxGraph.prototype.expandedImage=null,mxGraph.prototype.collapsedImage=null,mxConnectionHandler.prototype.connectImage=new mxImage(d.GetImagePath("arrow.png"),20,20),this.Graph.htmlLabels=!0,this.Graph.getLabel=function(e){var t=this.labelsVisible?this.convertValueToString(e):"";if(e.vertex){var n=t.split("_");return'<div class="subgraph-item-label label-'+e.bigtype+" "+e.using+'" data-id="'+e.id+'">'+n[n.length-1]+"</div>"}return t}},this.ConfigureStylesheet=function(){var e={};e[mxConstants.STYLE_STROKECOLOR]=d.ConstInfo.LineDefualtColor,e[mxConstants.STYLE_STROKEWIDTH]=1.3,e[mxConstants.STYLE_FONTSTYLE]=2,e[mxConstants.STYLE_PERIMETER_SPACING]=0,e[mxConstants.STYLE_ENDARROW]="",e[mxConstants.STYLE_FONTCOLOR]="#5e698a",e[mxConstants.STYLE_FONTSIZE]=12,e[mxConstants.STYLE_VERTICAL_ALIGN]=mxConstants.ALIGN_BOTTOM,e[mxConstants.STYLE_EDGE]=mxConstants.EDGESTYLE_ENTITY_RELATION,e[mxConstants.STYLE_SEGMENT]=0,this.Graph.getStylesheet().putCellStyle(E.enxHelper.ModelType.Link,e)},this.SetPortStatus=function(e,t){p.Graph.getModel().beginUpdate();try{var n=t?d.ConstInfo.SwimStyle:d.ConstInfo.UsedPort;e&&(e.using=t?"":"using",p.Graph.getModel().setStyle(e,n),p.SetCellConnectable(e,t),this.EditGraphCell.vertex&&e.setConnectable(!1))}finally{p.Graph.getModel().endUpdate()}},this.SetLoopLinkPosition=function(e){p.Graph.getModel().beginUpdate();try{e.geometry.points||e.data.sourcetopdevicename.value!=e.data.targettopdevicename.value||(e.geometry.points=[new mxPoint(310,370)])}finally{p.Graph.getModel().endUpdate()}},this.ApplyPermission=function(e){r=e},this.SetNodeCannotMove=function(){this.ApplyPermission(new t(!1,!1))},this.ResetNodeMovable=function(){this.ApplyPermission(new t)},this.EditCell=function(e){p.ApplyPermission(new t),this.SetTopNav(e&&e.data),this.Graph.getModel().clear(),(this.EditGraphCell=e)&&e.vertex?this.RenderNe(e,!0,void 0,!1):e&&e.edge&&this.InitLinkEditor(e),p.ApplyPermission(new t(!0,!1))},this.SetTopNav=function(e){u(".EplugGraphEditorTopNav").css("display",e?"block":"none"),u(".EplugGraphEditorSubEditor").css("padding-top",e?191:130),u(".EplugGraphEditorTopElementName").attr("data-val",e&&e._id||"").text(e&&e.objname&&e.objname.value||"")},this.GetRootDeviceCellInfo=function(e){if(e&&e.data&&e.data.IsTopDevice==E.enxConstField.BoolStr.Yes&&e.bigtype==E.enxHelper.ModelType.Network)return e;e=p.Graph.getModel().getParent(e);return!e||e.data&&e.data.IsTopDevice&&e.data.IsTopDevice==E.enxConstField.BoolStr.Yes?e:this.GetRootDeviceCellInfo(e)},this.ConnectHandler=mxUtils.bind(this,function(e,t){var n=t.properties.edge;if(!n.target)return!1;if(n.source.bigtype==E.enxHelper.ModelType.Network&&n.target.bigtype==E.enxHelper.ModelType.Network)return d.Property.CoreGraph.removeCells([n]),p.Graph.removeCells([n]),toastr.warning("No connection between the network!"),!1;n.style=E.enxHelper.ModelType.Link;var r=p.EditGraphCell.target.data[E.enxHelper.Field.ParentGID],o=h.CreateModel(E.enxHelper.ModelType.Link,r);o[E.enxConstField.AttrName.ENXFILE_ATTR_SOURCEDEVICEID][E.enxConstField.AttrName.ENXFILE_ATTR_VALUE]=n.source.id,o[E.enxConstField.AttrName.ENXFILE_ATTR_TARGETDEVICEID][E.enxConstField.AttrName.ENXFILE_ATTR_VALUE]=n.target.id,h.Property.BusyPortId.push(n.source.data.guid.value),h.Property.BusyPortId.push(n.target.data.guid.value),p.SetPortStatus(n.source,!1),p.SetPortStatus(n.target,!1);t=p.GetRootDeviceCellInfo(n.source),r=p.GetRootDeviceCellInfo(n.target);n.source[p.ConstInfo.ROOTDEVICE]=t.data,n.target[p.ConstInfo.ROOTDEVICE]=r.data,o[E.enxConstField.AttrName.ENXFILE_ATTR_SOURCETOPDEVICENAME][E.enxConstField.AttrName.ENXFILE_ATTR_VALUE]=t.value,o[E.enxConstField.AttrName.ENXFILE_ATTR_TARGETTOPDEVICENAME][E.enxConstField.AttrName.ENXFILE_ATTR_VALUE]=r.value,d.AttachCell(n,o),p.Graph.getModel().setValue(n,o[E.enxConstField.AttrName.ENXFILE_ATTR_OBJNAME][E.enxConstField.AttrName.ENXFILE_ATTR_VALUE]),p.SetLoopLinkPosition(n),e.connectionHandler.select=!1,p.EditGraphCell.edge&&(e=d.GetAllLink(p.Graph,void 0,!0),d.RenderVirtualLink(p.EditGraphCell.source,p.EditGraphCell.target,e))}),this.InitPopMenu=function(){p.Graph.popupMenuHandler.factoryMethod=function(e,t,n){var r,o;t&&(o=function(e,t){u(e).find("td:last").html('<span class="mxMenu-key">'+t+"</span>")},1==(r=0==(r=p.Graph.getSelectionCells()).length?[t]:r).length&&o(e.addItem("Edit",null,function(){d.PropertyPanel.EditNodeById(r[0].id)},null,"mxMenu edit"),"Enter"),o(e.addItem("Delete",null,function(){p.RemoveSelectCell(r)},null,"mxMenu delete"),"Del"))}},this.RemoveSelectCell=function(e){var t;0!=(e=e||p.Graph.getSelectionCells()).length&&(u.each(e,function(e,t){p.RemoveCellRel(t),h.RemoveModelByParentId(t.id,!0),h.RemoveModel(E.enxHelper.Field.ID,t.id),h.Property.GraphPlug.RemoveCellById(t.bigtype,t.id)}),(t=e[0])&&t.vertex&&"yes"!=t.data.IsTopDevice&&d.Property.CoreGraph.fireEvent(new mxEventObject(mxEvent.CLICK,"event",null,"cell",p.EditGraphCell)),p.Graph.removeCells(e),0==p.Graph.getChildVertices().length&&p.SetTopNav())},this.RemoveCellRel=function(e){if(e.edge)return p.SetPortStatus(e.target,!0),void p.SetPortStatus(e.source,!0);var t=[];e.bigtype==E.enxHelper.ModelType.Port&&-1<h.Property.BusyPortId.indexOf(e.id)?t.push(e):(e=d.GetAllNode(p.Graph,e,!0),t=u.grep(e,function(e,t){return e.bigtype==E.enxHelper.ModelType.Port&&-1<h.Property.BusyPortId.indexOf(e.id)})),0!=t.length&&u.each(t,function(e,n){var t=u.grep(h.Property.LstLinkJson,function(e,t){return e.sourcedeviceid.value==n.id||e.targetdeviceid.value==n.id});t&&0!=t.length&&(t=t[0]._id,d.RemoveCellById(E.enxHelper.ModelType.Link,t),h.RemoveModel(E.enxHelper.Field.ID,t))})},this.InitLinkEditor=function(e){p.Graph.removeListener(p.ConnectHandler);var t=e.source,n=e.target,e=t.id!=n.id?2:1;this.RenderNe(t,!0,e,!0),t.id!=n.id?(this.RenderNe(n,!0,e,!0),n=p.Graph.getModel().getEdgesBetween(t,n,!1),p.CopyLinkFromCoreGraph(n)):(t=p.Graph.getModel().getEdgesBetween(t,t,!1),p.CopyLinkFromCoreGraph(t)),p.Graph.addListener(mxEvent.CELL_CONNECTED,p.ConnectHandler)},this.CopyLinkFromCoreGraph=function(e){if(e&&0<e.length){var l={},t=d.GetAllNode(p.Graph,void 0,!0);u.each(t,function(e,t){t.bigtype!=E.enxHelper.ModelType.Port&&t.bigtype!=E.enxHelper.ModelType.Network||(l[t.data.guid.value]=t)});var a=p.Graph.getDefaultParent();p.Graph.getModel().beginUpdate();try{u.each(e,function(e,t){var n,r,o,i=t.data;i&&(n=i[E.enxConstField.AttrName.ENXFILE_ATTR_SOURCEDEVICEID][E.enxConstField.AttrName.ENXFILE_ATTR_VALUE],o=i[E.enxConstField.AttrName.ENXFILE_ATTR_TARGETDEVICEID][E.enxConstField.AttrName.ENXFILE_ATTR_VALUE],r=l[n],i=l[o],r&&i&&(p.SetCellConnectable(r,!1),p.SetCellConnectable(i,!1),r[p.ConstInfo.ROOTDEVICE]=t.source.data,i[p.ConstInfo.ROOTDEVICE]=t.target.data,o=p.Graph.insertEdge(a,t.id,t.objname,l[n],l[o],E.enxHelper.ModelType.Link),d.AttachCell(o,t.data),p.SetLoopLinkPosition(o)))})}finally{p.Graph.getModel().endUpdate()}}},this.SetCellConnectable=function(e,t){e&&e.bigtype!=E.enxHelper.ModelType.Network&&e.setConnectable(t)},this.RenderNe=function(e,t,n,r){var o,i,l,a={},s=p.Graph.getDefaultParent();p.Graph.getModel().beginUpdate();try{t?(o=E.jsonHelper.GetJsonByKey(h.Property.LstNodeJson,E.enxHelper.Field.ID,e.id),i=p.GetBond(o.BigType),l=d.Translater.JsonToCell(p.Graph,o,s,i,d.ConstInfo.SwimStyle),o.BigType==E.enxHelper.ModelType.Network?l.setConnectable(r):l.setConnectable(!1),a=l,-1<h.Property.BusyPortId.indexOf(o.guid.value)&&(l.setConnectable(!1),l.using="using")):a=s,p.RenderChildCell(e,a,t,n,r)}finally{p.Graph.getModel().endUpdate()}},this.GetBond=function(e){e=p.ConstInfo.ElementDeaultSet[e];return[0,0,e?e.Width:90,30]},this.RenderChildCell=function(e,r,o,i,l){e=E.jsonHelper.GetStrValue(e,d.ConstInfo.AttrName.ID),e=E.jsonHelper.FilterListByValues(h.Property.DataList,E.enxHelper.Field.ParentGID,[e]);u.each(e,function(e,t){if(o&&t.BigType==E.enxHelper.ModelType.Port&&t.internal_external&&t.internal_external.value){var n=t.internal_external.value.toLowerCase().indexOf("external");if(1==i&&-1<n)return!0;if(2==i&&-1==n)return!0}n=p.ConstInfo.ElementDeaultSet[t.BigType].Width,n=d.Translater.JsonToCell(p.Graph,t,r,[0,0,n,30],d.ConstInfo.SwimStyle,o);t.BigType==E.enxHelper.ModelType.Network?n.setConnectable(o&&l):n.setConnectable(t.BigType==E.enxHelper.ModelType.Port&&o&&l&&h.Property.BusyPortId.indexOf(t.guid.value)<0),-1<h.Property.BusyPortId.indexOf(t.guid.value)&&(p.Graph.getModel().setStyle(n,d.ConstInfo.UsedPort),n.using="using"),p.RenderChildCell(n,n,o,i,l)})},this.BindEvent=function(){p.Graph.addListener(mxEvent.CLICK,function(e,t){d.EditType=d.ConstInfo.EnumEditType.Element,t.properties.cell||d.PropertyPanel.Hide()}),u(".tools-delete").off("click").click(function(){p.RemoveSelectCell()})},this.ConstInfo=new function(){this.ElementDeaultSet=new function(){this.Ne={Width:200},this.Tester={Width:200},this.Dev={Width:200},this.Atm={Width:200},this.Sdh={Width:200},this.Eth={Width:200},this.Sftp={Width:200},this.Network={Width:105},this.Agent={Width:200},this.Board={Width:160},this.VM={Width:160},this.SubBoard={Width:140},this.Port={Width:90}},this.ROOTDEVICE="rootdevice"},this.InsertCell=function(e,t){var n=d.GetAllNode(p.Graph,null,!0),t=E.jsonHelper.GetJsonByKey(n,d.ConstInfo.AttrName.ID,t);E.jsonHelper.IsEmptyJson(t)||(d.SubGraph.ResetNodeMovable(),d.ExcuteDropInElement(p.Graph,t,e,[],d.ConstInfo.SwimStyle))}},this.ToggleToolBar=function(e){d.EditType==d.ConstInfo.EnumEditType.Topo?d.EditType=d.ConstInfo.EnumEditType.Element:d.EditType=d.ConstInfo.EnumEditType.Topo,u(".EplugGraphEditorElementItem").hide(),u(".EplugGraphEditorElementItem[data-edittype='"+d.EditType+"']").show(),u(".EplugGraphEditorElementItem[data-edittype='"+d.ConstInfo.EnumEditType.Network+"']").show(),u(".EplugGraphEditorTopMenu span").show(),u(".EplugGraphEditorTopMenu span[data-hidetype='"+d.EditType+"']").hide(),d.EditType!=d.ConstInfo.EnumEditType.Element||!e||e!=E.enxHelper.ModelType.Tester&&e!=E.enxHelper.ModelType.Dev&&e!=E.enxHelper.ModelType.Sftp&&e!=E.enxHelper.ModelType.Agent||(u(".EplugGraphEditorElementItem").hide(),u(".EplugGraphEditorElementItem[data-type='Port']").show())},this.PropertyPanel=new function(){var d=this;this.EditNodeJson={},this.CustomFields={},this.ElementId="EplugGraphEditorPropertyEditPanel",this.HtmlTemplate=new function(){this.FieldEditItem='<tr data-fieldname="{0}"><td class="EplugGraphEditorPropertyPanelFieldTitle EPlugTextEllipsis">{1}:</td><td><input value="{2}" type="text" class="field_value" /></td></tr>',this.FieldShowItem='<tr data-fieldname="{0}"><td class="EplugGraphEditorPropertyPanelFieldTitle EPlugTextEllipsis">{1}:</td><td><label class="EPlugTextEllipsis EplugGraphEditorPropertyPanelFieldLink" title="{3}" data-val="{2}">{3}</label></td></tr>',this.FieldEditSelItem='<tr data-fieldname="{0}"><td class="EplugGraphEditorPropertyPanelFieldTitle EPlugTextEllipsis">{1}:</td><td><select>{2}</select></td></tr>',this.SelectOptionItem='<option value="{0}" {2}>{1}</option>',this.FieldEditCustomItem='<tr class="custom_field" data-fieldname="{0}"><td><input type="text" class="custom_field_key" placeholder="Key" value="{0}" /><span>:</span></td><td><input type="text" class="custom_field_value field_value" placeholder="Value" value="{1}" /><span class="glyphicon glyphicon-plus custom_field_add" aria-hidden="true" title="Add"></span><span class="glyphicon glyphicon-minus custom_field_delete" aria-hidden="true" title="Delete"></span></td></tr>'},this.Init=function(){this.BindEvent()},this.GetElement=function(e){return u("#"+d.ElementId).find(e)},this.BindEvent=function(){d.GetElement(".EplugGraphEditorPropertyPanelTitleBtn").off("click").click(function(){d.Hide()}),u("#"+d.ElementId).off("change").on("change","input,select",function(){d.updateProperties()})},this.updateProperties=function(){var e=d.GetNodeJson();E.jsonHelper.IsEmptyJson(e)||(u.each(d.CustomFields,function(e,t){delete d.EditNodeJson[e]}),e=E.jsonHelper.JsonArrSingleUpdate(h.Property.DataList,E.enxHelper.Field.ID,E.enxConstField.AttrName.ENXFILE_ATTR_VALUE,d.EditNodeJson._id,e),h.Property.GraphPlug.UpdateCell(d.EditNodeJson.BigType,e))},this.GetNodeJson=function(){var l={};return d.GetElement(".EplugGraphEditorPropertyPanelLst tr").each(function(e,t){var n,r,o=u(this),i=o.attr("data-fieldname");i&&(0<(r=o.find("input.field_value")).length&&(n=u.trim(r.val()),i==E.enxConstField.AttrName.ENXFILE_ATTR_OBJNAME)&&((o=h.GetObjectNameCache())[n]&&o[n]!=d.EditNodeJson._id&&(n+=h.ConstInfo.RepeatedSingal,r.val(n))),void 0!==(n=0<(r=u(this).find("select")).length?r.val():n)&&(l[i]=n))}),l},this.Show=function(){u("#"+d.ElementId).show(200)},this.Hide=function(){this.Reset(),u("#"+d.ElementId).hide(200)},this.Reset=function(){d.GetElement(".EplugGraphEditorPropertyPanelLst").empty()},this.AddField=function(e){e=E.enxHelper.Format(d.HtmlTemplate.FieldEditItem,e,e,"");d.GetElement(".EplugGraphEditorPropertyPanelLst").append(e)},this.AddTr=function(e){d.GetElement(".EplugGraphEditorPropertyPanelLst").append(e)},this.EditNodeById=function(e){var t,n,s,p,r;e&&(d.EditNodeJson=E.jsonHelper.GetJsonByKey(h.Property.DataList,E.enxHelper.Field.ID,e),!E.jsonHelper.IsEmptyJson(d.EditNodeJson))&&(d.Show(),d.Reset(),t=d.EditNodeJson.BigType,n=h.HtmlEditor.GetModelField(t),s=h.GetSpecialField(t),p=h.ConstInfo.SelectField,u.each(n,function(e,t){var n,r,o=h.GetDisplayFieldName(t),i=E.jsonHelper.GetJsonValue(d.EditNodeJson,t),l=E.jsonHelper.GetStrValue(i,E.enxConstField.AttrName.ENXFILE_ATTR_VALUE).replace(new RegExp('"',"gm"),"&quot;"),a=l,i="";h.ConstInfo.NoEditField.indexOf(t)<0&&(-1<s.indexOf(t)?(r=E.jsonHelper.GetJsonByKeyAndSecondKey(h.Property.LstPortJson,E.enxConstField.AttrName.ENXFILE_ATTR_GUID,E.enxConstField.AttrName.ENXFILE_ATTR_VALUE,l),E.jsonHelper.IsEmptyJson(r)||(a=r[E.enxConstField.AttrName.ENXFILE_ATTR_OBJNAME][E.enxConstField.AttrName.ENXFILE_ATTR_VALUE]),i=u(E.enxHelper.Format(d.HtmlTemplate.FieldShowItem,t,o,l,a)),d.BindEventForLink(i)):i=-1<p.indexOf(t)?(n="",r=h.Property.SelectOptionValues[t],u.each(r,function(e,t){n+=a&&a==t?E.enxHelper.Format(d.HtmlTemplate.SelectOptionItem,t,t,"selected='selected'"):E.enxHelper.Format(d.HtmlTemplate.SelectOptionItem,t,t,"")}),u(E.enxHelper.Format(d.HtmlTemplate.FieldEditSelItem,t,o,n))):u(E.enxHelper.Format(d.HtmlTemplate.FieldEditItem,t,o,l)),d.AddTr(i))}),e=E.jsonHelper.GetJsonAllKey(d.EditNodeJson),r=(r=h.HtmlEditor.GetModelUnAvailField(t)).concat(E.jsonHelper.GetJsonAllValue(E.enxHelper.Field),n),e=u.grep(e,function(e){return-1==u.inArray(e,r)}),d.CustomFields={},u.each(e,function(e,t){d.CustomFields[t]=d.EditNodeJson[t].value}),d.InitCustomFields())},this.BindEventForLink=function(e){e.find(".EplugGraphEditorPropertyPanelFieldLink").off("click").click(function(){var e=u(this).attr("data-val");d.EditNodeById(e)})},this.InitCustomFields=function(){var e=d.CustomFields;u.isEmptyObject(e)?d.AddCustomField():u.each(e,function(e,t){d.AddCustomField(void 0,e,t)})},this.AddCustomField=function(e,t,n){n=u(E.enxHelper.Format(d.HtmlTemplate.FieldEditCustomItem,t||"",n||""));e?e.after(n):d.AddTr(n),d.BindEventForCustomOps(n)},this.BindEventForCustomOps=function(t){t.off("click").on("click",".custom_field_add,.custom_field_delete",function(){u(this).hasClass("custom_field_add")?d.AddCustomField(t):(t.remove(),d.updateProperties())}),t.off("change").on("change",".custom_field_key",function(){var e=u.trim(u(this).val());e&&t.attr("data-fieldname",e)})}},this.GetDisplayNodeName=function(e,t){if(!E.jsonHelper.IsEmptyJson(e)){var n,r=e[E.enxConstField.AttrName.ENXFILE_ATTR_OBJNAME][E.enxConstField.AttrName.ENXFILE_ATTR_VALUE],o=E.jsonHelper.GetJsonValue(e,E.enxConstField.AttrName.ENXFILE_ATTR_ROLER)[E.enxConstField.AttrName.ENXFILE_ATTR_VALUE],r=r;return e.BigType==E.enxHelper.ModelType.Ne&&o&&(r+="("+o+")"),r=t&&e.BigType==E.enxHelper.ModelType.Port&&(n=E.jsonHelper.GetJsonValue(e,E.enxConstField.AttrName.ENXFILE_ATTR_INTERFACE)[E.enxConstField.AttrName.ENXFILE_ATTR_VALUE])?n:r}},this.RenderData=function(){this.Property.CoreGraph.getModel().beginUpdate();var l=this.Property.CoreGraph.getDefaultParent();l[this.ConstInfo.AttrName.CANVASID]=h.Property.TopoNode._id,l[this.ConstInfo.AttrName.BIGTYPE]=h.Property.TopoNode.BigType;try{var a={};u.each(h.Property.LstNodeJson,function(e,t){var n=d.Translater.JsonToCell(d.Property.CoreGraph,t,l),t=t[E.enxConstField.AttrName.ENXFILE_ATTR_OBJNAME][E.enxConstField.AttrName.ENXFILE_ATTR_VALUE];a[t]=n}),u.each(h.Property.LstLinkJson,function(e,t){var n=E.jsonHelper.GetJsonValue(t,E.enxConstField.AttrName.ENXFILE_ATTR_SOURCETOPDEVICENAME)[E.enxConstField.AttrName.ENXFILE_ATTR_VALUE],r=E.jsonHelper.GetJsonValue(t,E.enxConstField.AttrName.ENXFILE_ATTR_TARGETTOPDEVICENAME)[E.enxConstField.AttrName.ENXFILE_ATTR_VALUE],o=E.jsonHelper.GetJsonValue(a,n),i=E.jsonHelper.GetJsonValue(a,r);if(E.jsonHelper.IsEmptyJson(o)&&E.jsonHelper.IsEmptyJson(i))return!0;n=t[E.enxConstField.AttrName.ENXFILE_ATTR_OBJNAME][E.enxConstField.AttrName.ENXFILE_ATTR_VALUE],r=t[E.enxHelper.Field.ID];d.InsertLink(l,r,n,o,i,E.enxHelper.ModelType.Link,t),t.group&&(t=t.group.value,d.ResetMaxGroupIndex(t))})}finally{this.Property.CoreGraph.getModel().endUpdate()}},this.RenderVirtualLink=function(o,i,l){var e=this.GetLinksBetween(o,i,!1),a=this.Property.CoreGraph,s=this;if(a.removeCells(e),l){var p=a.getDefaultParent();a.getModel().beginUpdate();try{u.each(l,function(e,t){var n=t.source.rootdevice._id==o.id?o:i,r=t.target.rootdevice._id==i.id?i:o,t=d.InsertLink(p,t.id,t.objname,n,r,E.enxHelper.ModelType.Link,t.data);e==l.length-1&&(a.setSelectionCell(t),s.SubGraph.SetTopNav(t.data))})}finally{a.getModel().endUpdate()}}},this.GetLinksBetween=function(e,t,n){var r=[];return r=this.Property.CoreGraph.getModel().getEdgesBetween(e,t,!1),n&&(e=this.Property.CoreGraph.getModel().getEdgesBetween(e,e,!1),r=r.concat(e),t=this.Property.CoreGraph.getModel().getEdgesBetween(t,t,!1),r=r.concat(t)),r},this.RemoveLink=function(n,r){this.Property.CoreGraph.removeCells([n]);var e=this.Property.CoreGraph.getModel().getEdgesBetween(n.source,n.target,!1),o=n.data&&n.data.group&&n.data.group.groupshow,i=[];u.each(e,function(e,t){o&&t.data.group&&t.data.group.value==n.data.group.value&&(r?(d.RemoveLink(t),h.RemoveModel(E.enxHelper.Field.ID,t.id)):i.push(t.id))}),0<i.length&&d.GroupLink(i)},this.AttachCell=function(e,t){var n=t[E.enxHelper.Field.ID],r=t[E.enxHelper.Field.BigType],o=t[E.enxConstField.AttrName.ENXFILE_ATTR_OBJNAME][E.enxConstField.AttrName.ENXFILE_ATTR_VALUE];e[d.ConstInfo.AttrName.BIGTYPE]=r,e[d.ConstInfo.AttrName.OBJNAME]=o,e[d.ConstInfo.AttrName.DATA]=t,e[d.ConstInfo.AttrName.CANVASID]=n,e[d.ConstInfo.AttrName.ID]=n},this.ResetMaxGroupIndex=function(e){e=e.match(new RegExp("0|[1-9]\\d*","gm"));e&&0<e.length&&this.Property.LinkGroupIndex<=parseInt(e[e.length-1])&&(this.Property.LinkGroupIndex=parseInt(e[e.length-1])+1)},this.Translater=new function(){this.FixFlex=new function(){this.XAdd=5,this.YAdd=25},this.GetJsonBond=function(e){var t,n,r=[0,0,d.ConstInfo.FixWidth,d.ConstInfo.FixHeight],o=E.jsonHelper.GetJsonValue(e,E.enxConstField.AttrName.ENXFILE_ATTR_POSITION)[E.enxConstField.AttrName.ENXFILE_ATTR_VALUE];return o&&-1<o.indexOf(";")&&(-1<(n=o.split(";"))[e=t=0].indexOf(",")&&(o=n[0].split(","),t=parseInt(o[0])-this.FixFlex.XAdd,e=parseInt(o[1])-this.FixFlex.YAdd),-1<n[1].indexOf(",")&&(n=n[1].split(","),parseInt(n[0]),this.FixFlex.XAdd,parseInt(n[1]),this.FixFlex.YAdd),r[0]=t,r[1]=e,r[2]=62,r[3]=62),r},this.BondToString=function(e){var t=e[d.ConstInfo.AttrName.GEOMETRY],n=(t=t||{x:0,y:0,width:0,height:0}).x+this.FixFlex.XAdd,e=t.y+this.FixFlex.YAdd;return n+","+e+";"+(n+t.width)+","+(e+t.height)},this.JsonToCell=function(e,t,n,r,o,i){if(!u.isEmptyObject(t)){var l=r;r&&0!=r.length||(l=d.Translater.GetJsonBond(t));var a=t[E.enxHelper.Field.ID],r=d.GetDisplayNodeName(t,i),i=t[E.enxHelper.Field.BigType],i=(t[E.enxConstField.AttrName.ENXFILE_ATTR_OBJNAME][E.enxConstField.AttrName.ENXFILE_ATTR_VALUE],e.insertVertex(n,a,r,l[0],l[1],l[2],l[3],o||i));return d.AttachCell(i,t),i}}},this.GetImagePath=function(e){var t=h.OptionParam;return t.root+t.imageDir+e},this.ConfigureStylesheet=function(){var e={};e[mxConstants.STYLE_SHAPE]=mxConstants.SHAPE_IMAGE,e[mxConstants.STYLE_IMAGE]=this.GetImagePath("v-ne.png"),e[mxConstants.STYLE_VERTICAL_ALIGN]=mxConstants.ALIGN_TOP,e[mxConstants.STYLE_VERTICAL_LABEL_POSITION]=mxConstants.ALIGN_BOTTOM,e[mxConstants.STYLE_FONTCOLOR]="#333",this.Property.CoreGraph.getStylesheet().putCellStyle(E.enxHelper.ModelType.Ne,e);var t=u.extend({},e);t[mxConstants.STYLE_IMAGE]=this.GetImagePath("v-tester.png"),this.Property.CoreGraph.getStylesheet().putCellStyle(E.enxHelper.ModelType.Tester,t);t=u.extend({},e);t[mxConstants.STYLE_IMAGE]=this.GetImagePath("v-tester.png"),this.Property.CoreGraph.getStylesheet().putCellStyle(E.enxHelper.ModelType.Dev,t);t=u.extend({},e);t[mxConstants.STYLE_IMAGE]=this.GetImagePath("v-atm.png"),this.Property.CoreGraph.getStylesheet().putCellStyle(E.enxHelper.ModelType.Atm,t);t=u.extend({},e);t[mxConstants.STYLE_IMAGE]=this.GetImagePath("v-eth.png"),this.Property.CoreGraph.getStylesheet().putCellStyle(E.enxHelper.ModelType.Eth,t);t=u.extend({},e);t[mxConstants.STYLE_IMAGE]=this.GetImagePath("v-sdh.png"),this.Property.CoreGraph.getStylesheet().putCellStyle(E.enxHelper.ModelType.Sdh,t);t=u.extend({},e);t[mxConstants.STYLE_IMAGE]=this.GetImagePath("v-sftp.png"),this.Property.CoreGraph.getStylesheet().putCellStyle(E.enxHelper.ModelType.Sftp,t);t=u.extend({},e);t[mxConstants.STYLE_IMAGE]=this.GetImagePath("v-agent.png"),this.Property.CoreGraph.getStylesheet().putCellStyle(E.enxHelper.ModelType.Agent,t);t=u.extend({},e);t[mxConstants.STYLE_IMAGE]=this.GetImagePath("v-network.png"),this.Property.CoreGraph.getStylesheet().putCellStyle(E.enxHelper.ModelType.Network,t);e={};e[mxConstants.STYLE_STROKECOLOR]=d.ConstInfo.LineDefualtColor,e[mxConstants.STYLE_STROKEWIDTH]=1.3,e[mxConstants.STYLE_FONTSTYLE]=2,e[mxConstants.STYLE_PERIMETER_SPACING]=1,e[mxConstants.STYLE_ENDARROW]="",e[mxConstants.STYLE_FONTCOLOR]="#5e698a",e[mxConstants.STYLE_FONTSIZE]=12,e[mxConstants.STYLE_VERTICAL_ALIGN]=mxConstants.ALIGN_BOTTOM,this.Property.CoreGraph.getStylesheet().putCellStyle(E.enxHelper.ModelType.Link,e);t=u.extend({},e);t[mxConstants.STYLE_CURVED]=!0,this.Property.CoreGraph.getStylesheet().putCellStyle(d.ConstInfo.LoopLinkStyleName,t);t=u.extend({},e);t[mxConstants.STYLE_CURVED]=!0,t[mxConstants.STYLE_STROKEWIDTH]=1.3,t[mxConstants.STYLE_STROKECOLOR]="#525ae9",this.Property.CoreGraph.getStylesheet().putCellStyle(d.ConstInfo.LoopGroupLinkStyleName,t);e=u.extend({},e);e[mxConstants.STYLE_DASHED]=1,this.Property.CoreGraph.getStylesheet().putCellStyle(d.ConstInfo.VirtualLinkStyleName,e)},this.GetAllNode=function(n,e,r){var e=e||n.getDefaultParent(),o=n.getModel().getChildVertices(e);return r&&o&&0<o.length&&u.each(o,function(e,t){t=d.GetAllNode(n,t,r);o=o.concat(t)}),o},this.GetAllLink=function(n,e,r){var o=[],e=e||n.getDefaultParent(),o=n.getModel().getChildEdges(e);return r&&(e=n.getModel().getChildVertices(e),u.each(e,function(e,t){t=d.GetAllLink(n,t,r);o=o.concat(t)})),o},this.GetCellsByFieldValue=function(e,t,n){var r=[];switch(e){case E.enxHelper.ModelType.Ne:case E.enxHelper.ModelType.Tester:case E.enxHelper.ModelType.Dev:case E.enxHelper.ModelType.Sdh:case E.enxHelper.ModelType.Atm:case E.enxHelper.ModelType.Eth:case E.enxHelper.ModelType.Board:case E.enxHelper.ModelType.SubBoard:case E.enxHelper.ModelType.Port:r=this.GetAllNode(d.Property.CoreGraph);break;case E.enxHelper.ModelType.Link:r=this.GetAllLink(d.Property.CoreGraph);break;default:r=this.GetAllNode(d.Property.CoreGraph)}return E.jsonHelper.GetJsonByKey(r,t,n)},this.UpdateCell=function(e,t){var n,r=E.jsonHelper.GetStrValue(t,E.enxHelper.Field.ID),o=t.IsTopDevice==E.enxConstField.BoolStr.Yes,i=e==E.enxHelper.ModelType.Link;e=o||i?d.GetCellsByFieldValue(e,d.ConstInfo.AttrName.ID,r):(n=d.GetAllNode(d.SubGraph.Graph,null,!0),E.jsonHelper.GetJsonByKey(n,d.ConstInfo.AttrName.ID,t._id)),E.jsonHelper.IsEmptyJson(e)||(n=e.objname!=t.objname.value,o&&n&&d.UpdateCellRelChildren(r,e.objname,t.objname.value),r=d.GetDisplayNodeName(t),e[d.ConstInfo.AttrName.OBJNAME]=t[E.enxConstField.AttrName.ENXFILE_ATTR_OBJNAME][E.enxConstField.AttrName.ENXFILE_ATTR_VALUE],e[d.ConstInfo.AttrName.DATA]=t,d.Property.CoreGraph.getModel().setValue(e,r),d.SubGraph.Graph.getModel().setValue(e,r),(o&&n||i)&&d.SubGraph.EditCell(e))},this.UpdateCellRelChildren=function(e,r,o){e=h.GetChildrens(e,!0);u.each(e,function(e,t){var n=t.objname.value;0==n.indexOf(r)&&n.substr(r.length,1)==E.enxConstField.NameSeparate&&(n=n.replace(r,o)),t[E.enxConstField.AttrName.ENXFILE_ATTR_OBJNAME][E.enxConstField.AttrName.ENXFILE_ATTR_VALUE]=n,d.UpdateCell(t.BigType,t)})},this.BasicFixSet=function(){this.Property.CoreGraph.cellsResizable=!1,this.Property.CoreGraph.cellsEditable=!1,this.Property.CoreGraph.edgeLabelsMovable=!1,this.Property.CoreGraph.allowDanglingEdges=!1,this.Property.CoreGraph.allowLoops=!0,this.Property.CoreGraph.setConnectable(!0),this.Property.CoreGraph.setDropEnabled(!0),this.Property.CoreGraph.setTooltips(!0);var t=new mxParallelEdgeLayout(this.Property.CoreGraph);new mxLayoutManager(this.Property.CoreGraph).getLayout=function(e){if(0<e.getChildCount())return t},new mxRubberband(this.Property.CoreGraph),d.ConfigureStylesheet(),mxConstants.DEFAULT_FONTFAMILY="Helvetica,Arial",mxConstants.VERTEX_SELECTION_COLOR="#87CEEB",mxConstants.VERTEX_SELECTION_STROKEWIDTH=1.3,mxConstants.VERTEX_SELECTION_DASHED=!1,mxConstants.EDGE_SELECTION_COLOR="#87CEEB",mxConstants.EDGE_SELECTION_DASHED=!1,mxConstants.EDGE_SELECTION_STROKEWIDTH=1.3,mxConstants.DEFAULT_FONTSIZE=14,mxConstants.HIGHLIGHT_STROKEWIDTH=1.3,mxConstants.LOCKED_HANDLE_FILLCOLOR="#87CEEB",mxConstants.HANDLE_STROKECOLOR="#87CEEB",mxEvent.disableContextMenu(this.Property.Contain),new mxCellTracker(this.Property.CoreGraph,"#87CEEB"),mxCellHighlight.prototype.spacing=0,this.Property.CoreGraph.setCellsResizable(!1),this.Property.CoreGraph.setCellsBendable(!1),delete this.Property.CoreGraph.getStylesheet().getDefaultEdgeStyle().endArrow,mxRectangleShape.prototype.crisp=!0,mxGraphHandler.prototype.guidesEnabled=!0,this.PermissionApply(new this.Permission(!1),this.Property.CoreGraph),this.ExtendsHook(this.Property.CoreGraph),this.Property.CoreGraph.getTooltipForCell=function(e){if(e.vertex){var t=e.data;return'<ul class="core_tip"><li><span class="tip_title">Name:</span><span>'+t.objname.value+'</span></li><li><span class="tip_title">IP:</span><span>'+t.ip.value+'</span></li><li><span class="tip_title">Type:</span><span>'+t.type.value+"</span></li></ul>"}return e.value},this.IconSet(this.Property.CoreGraph)},this.IconSet=function(r){function n(t){this.images=[],t.view.graph;var e=mxUtils.createImage(d.GetImagePath("edit.png"));e.setAttribute("title","Edit"),e.style.position="absolute",e.style.cursor="pointer",e.style.width="20px",e.style.height="20px",e.style.left=t.x+t.width+"px",e.style.top=t.y-16+"px",mxEvent.addGestureListeners(e,mxUtils.bind(this,function(e){mxEvent.consume(e)})),mxEvent.addListener(e,"click",mxUtils.bind(this,function(e){d.PropertyPanel.EditNodeById(t.cell.id),mxEvent.consume(e),this.destroy()})),t.view.graph.container.appendChild(e),this.images.push(e)}n.prototype.destroy=function(){if(null!=this.images)for(var e=0;e<this.images.length;e++){var t=this.images[e];t.parentNode.removeChild(t)}this.images=null},r.addMouseListener({currentState:null,currentIconSet:null,mouseDown:function(e,t){null!=this.currentState&&(this.dragLeave(t.getEvent(),this.currentState),this.currentState=null)},mouseMove:function(e,t){if(null!=this.currentState&&(t.getState()==this.currentState||null==t.getState())){var n=new mxRectangle(t.getGraphX()-20,t.getGraphY()-20,40,40);if(mxUtils.intersects(n,this.currentState))return}n=r.view.getState(t.getCell()),(n=r.isMouseDown||null!=n&&!r.getModel().isVertex(n.cell)?null:n)!=this.currentState&&(null!=this.currentState&&this.dragLeave(t.getEvent(),this.currentState),this.currentState=n,null!=this.currentState&&this.dragEnter(t.getEvent(),this.currentState))},mouseUp:function(e,t){},dragEnter:function(e,t){null==this.currentIconSet&&(this.currentIconSet=new n(t))},dragLeave:function(e,t){null!=this.currentIconSet&&(this.currentIconSet.destroy(),this.currentIconSet=null)}})},this.ExtendsHook=function(e){var r=e.isCellDisconnectable;e.isCellDisconnectable=function(e,t,n){return r.apply(this,arguments)&&o.editEdges}},this.PermissionApply=function(e,t){o=e},this.Permission=function(e,t,n,r,o){this.editEdges=null==e||e,this.editVertices=null==t||t,this.locked=null!=n&&n,this.createEdges=null==r||r,this.cloneCells=null==o||o},this.Permission.prototype.apply=function(e){e.setConnectable(this.createEdges),e.setCellsLocked(this.locked)},this.GetCurrentGraph=function(){return d.EditType==d.ConstInfo.EnumEditType.Topo&&(graph=d.Property.CoreGraph),d.EditType==d.ConstInfo.EnumEditType.Element&&(graph=d.SubGraph.Graph),graph},this.ConnectHandler=mxUtils.bind(this,function(e,t){var n=t.properties.edge,r=d.Property.CoreGraph;return r.getModel(),!!n.target&&(n.source.bigtype==E.enxHelper.ModelType.Network&&n.target.bigtype==E.enxHelper.ModelType.Network?(r.removeCells([n]),toastr.warning("No connection between the network!"),!1):(n.bigtype=E.enxHelper.ModelType.Link,n.style=d.ConstInfo.VirtualLinkStyleName,void setTimeout(function(){r.fireEvent(new mxEventObject(mxEvent.CLICK,"event",t,"cell",n))},100)))}),this.BindEventForMenu=function(){u(".spanEditorBtnSaveImg").off("click").click(function(){d.SaveAsImage()})},this.GetImageUrl=function(){var t="",e=d.GetCurrentGraph(),n=e.getGraphBounds(),r=Math.round(n.x+n.width+4),n=Math.round(n.y+n.height+4),e=mxUtils.getXml(mxUtils.getViewXml(e,1),"\n"),e={height:n,width:r,mxXml:encodeURIComponent(e)};return u.ajax({type:"POST",url:"/Home/EnxToImage",data:JSON.stringify(e),dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){t=e.url,window.open("about:blank").document.write("<img src='"+t+"' alt='No Image'/>")}}),t},this.SaveAsImage=function(){d.GetImageUrl()},this.OnClick=function(e,t){d.EditType=d.ConstInfo.EnumEditType.Topo,d.SelectItemHandle();t=t.getProperty("cell");h.toggleRightContainer(t),d.PropertyPanel.Hide(),d.SubGraph.EditCell(t)},this.BindEvent=function(){d.Property.CoreGraph.addListener(mxEvent.CLICK,d.OnClick);var e=u(".EplugGraphEditorElementItem,.SubToolbarItem");u.each(e,function(e,t){mxClient.IS_IE&&mxEvent.addListener(t,"dragstart",function(e){e.returnValue=!1}),t.onselectstart=function(){return!1};var n=mxUtils.makeDraggable(t,function(e){return d.EditType=u(t).attr("data-edittype"),d.GetCurrentGraph()},function(e,t,n,r,o){d.DropInElement(e,t,n,r,o,this.dragElement)},t.cloneNode(!0),null,null,d.Property.CoreGraph.autoscroll,!0);n.isGuidesEnabled=function(){return d.Property.CoreGraph.graphHandler.guidesEnabled},n.createDragElement=mxDragSource.prototype.createDragElement}),d.Property.CoreGraph.removeListener(d.ConnectHandler),d.Property.CoreGraph.addListener(mxEvent.CELL_CONNECTED,d.ConnectHandler),d.BindKeyEvent()},this.KeyHandler=function(e){var t,n;d.Property.CoreGraph.isSelectionEmpty()||(n=t=0,37==e?t=-1:38==e?n=-1:39==e?t=1:40==e&&(n=1),d.Property.CoreGraph.moveCells(d.Property.CoreGraph.getSelectionCells(),t,n))},this.BindKeyEvent=function(){var e=new mxKeyHandler(d.Property.CoreGraph);e.bindKey(13,function(){var e=d.GetCurrentGraph().getSelectionCell();e&&d.PropertyPanel.EditNodeById(e.id)}),e.bindKey(37,function(){d.KeyHandler(37)}),e.bindKey(38,function(){d.KeyHandler(38)}),e.bindKey(39,function(){d.KeyHandler(39)}),e.bindKey(40,function(){d.KeyHandler(40)}),e.bindKey(46,function(){var e=d.GetCurrentGraph().getSelectionCells();d.EditType==d.ConstInfo.EnumEditType.Topo&&d.RemoveSelectCell(e),d.EditType==d.ConstInfo.EnumEditType.Element&&d.SubGraph.RemoveSelectCell(e)}),e.bindControlKey(65,function(){d.selectAll()}),e.bindControlKey(67,function(){d.Copy()}),e.bindControlKey(86,function(){d.Paste()})},this.GetTopDeviceBond=function(e,t,n){return[t,n,62,62]},this.DropInElement=function(e,t,n,r,o,i){var l=u(i).attr("data-type"),a={},s=[],i="";d.EditType==d.ConstInfo.EnumEditType.Topo&&(e=d.Property.CoreGraph,-1<E.enxHelper.ModelTypeOfTopDevice.indexOf(l)&&(a=e.getDefaultParent(),s=d.GetTopDeviceBond(l,r,o))),d.EditType==d.ConstInfo.EnumEditType.Element&&(((o=n&&n.bigtype||"")!=E.enxHelper.ModelType.Ne||l!=E.enxHelper.ModelType.Board&&l!=E.enxHelper.ModelType.Port&&l!=E.enxHelper.ModelType.VM&&l!=E.enxHelper.ModelType.Network)&&(o!=E.enxHelper.ModelType.Board&&o!=E.enxHelper.ModelType.VM||l!=E.enxHelper.ModelType.SubBoard&&l!=E.enxHelper.ModelType.Port)&&(o!=E.enxHelper.ModelType.SubBoard||l!=E.enxHelper.ModelType.Port)&&(o!=E.enxHelper.ModelType.Tester&&o!=E.enxHelper.ModelType.Sftp&&o!=E.enxHelper.ModelType.Agent||l!=E.enxHelper.ModelType.Port)||(a=n),d.SubGraph.ResetNodeMovable(),e=d.SubGraph.Graph,i=d.ConstInfo.SwimStyle),E.jsonHelper.IsEmptyJson(a)?toastr.warning("Subelements are not allowed to add!"):(s=d.ExcuteDropInElement(e,a,l,s,i)).vertex&&((i=u(e.container)).scrollTop(i.height()),e.setSelectionCell(s),e.fireEvent(new mxEventObject(mxEvent.CLICK,"event",t,"cell",s)))},this.ExcuteDropInElement=function(e,t,n,r,o){var i=E.jsonHelper.GetStrValue(t,d.ConstInfo.AttrName.OBJNAME),l=E.jsonHelper.GetStrValue(t,d.ConstInfo.AttrName.CANVASID),a=E.jsonHelper.GetStrValue(t,d.ConstInfo.AttrName.BIGTYPE),i=h.CreateModel(n,l,i,a),a=r;r&&0!=r.length||(a=d.SubGraph.GetBond(n));o=this.Translater.JsonToCell(e,i,t,a,o);return d.EditType==d.ConstInfo.EnumEditType.Topo?o.setConnectable(!0):(d.SubGraph.EditGraphCell.vertex?o.setConnectable(!1):o.setConnectable(o.bigtype==E.enxHelper.ModelType.Port||o.bigtype==E.enxHelper.ModelType.Network),d.SubGraph.SetNodeCannotMove(),e.cellRenderer.redrawLabel(e.view.getState(o))),o},this.InitPopMenu=function(){d.Property.CoreGraph.popupMenuHandler.factoryMethod=function(e,n,t){function r(e,t){u(e).find("td:last").html('<span class="mxMenu-key">'+t+"</span>")}var o,i,l,a=d.Property.CoreGraph.getSelectionCells();n&&n.edge&&(o=n.source.id,i=n.target.id,0<(l=u.grep(a,function(e,t){return e.edge&&e.id!=n.id&&(e.source.id==o&&e.target.id==i||e.target.id==o&&e.source.id==i)})).length&&e.addItem("Group",null,function(){d.CombineLinkToGroup(n,l,!0)},null),n.group&&e.addItem("UnGroup",null,function(){d.PullLinkFromGroup(n)},null)),n&&n.vertex&&r(e.addItem("Copy",null,function(){d.Copy()},null,"mxMenu copy"),"Ctrl+C"),0<a.length?(1==a.length&&r(e.addItem("Edit",null,function(){d.PropertyPanel.EditNodeById(a[0].id)},null,"mxMenu edit"),"Enter"),r(e.addItem("Delete",null,function(){d.RemoveSelectCell(a)},null,"mxMenu delete"),"Del")):r(e.addItem("Select All",null,function(){d.selectAll()},null,"mxMenu select"),"Ctrl+A"),n||mxClipboard.isEmpty()||r(e.addItem("Paste",null,function(){d.Paste()},null,"mxMenu paste"),"Ctrl+V")}},this.RemoveSelectCell=function(e){var r=[],o=[];u.each(e,function(e,t){var n;t.bigtype==E.enxHelper.ModelType.Link?(r.push(t),t.group&&(n=d.GetSameGroupLink(t),r=r.concat(n))):(o.push(t),(n=t.edges)&&u.each(n,function(e,t){h.RemoveModel(E.enxHelper.Field.ID,t.id)}),h.RemoveModelByParentId(t.id,!0)),h.RemoveModel(E.enxHelper.Field.ID,t.id)}),u.each(r,function(e,t){d.RemoveLink(t,!0)}),d.Property.CoreGraph.removeCells(o,!0),d.SubGraph.EditCell()},this.RemoveCellById=function(e,t){var n=d.Property.CoreGraph,r=[];switch(e){case E.enxHelper.ModelType.Link:r=this.GetAllLink(n);break;case E.enxHelper.ModelType.Ne:case E.enxHelper.ModelType.Tester:case E.enxHelper.ModelType.Sftp:case E.enxHelper.ModelType.Agent:case E.enxHelper.ModelType.Network:case E.enxHelper.ModelType.Atm:case E.enxHelper.ModelType.Eth:case E.enxHelper.ModelType.Sdh:r=this.GetAllNode(n)}!r||0==r.length||(t=E.jsonHelper.GetJsonByKey(r,"id",t)).id&&(e==E.enxHelper.ModelType.Link?d.RemoveLink(t):n.removeCells([t]))},this.GetSameGroupLink=function(n){var e=d.GetAllLink(d.Property.CoreGraph);return u.grep(e,function(e,t){return e.edge&&e.group&&e.group==n.group&&e.id!=n.id})},this.SetNodeAttr=function(e,t,n){var r=e.bigtype;h.SetNodeAttr(r,e.id,t,n),e[t]=n[E.enxConstField.AttrName.ENXFILE_ATTR_VALUE]},this.RemoveNodeAttr=function(e,t){var n=e.bigtype;h.DeleteNodeAttr(n,e.id,t),delete e[t]},this.CombineLinkToGroup=function(e,t,r){var n,o;t&&0<t.length&&(d.Property.CoreGraph.toggleCells(!1,t),n=d.CreateLinkGroupName(e),o=E.enxHelper.AttrParameter(d.ConstInfo.AttrName.GROUP,n),d.PushLinkToGroup(e,n),u.each(t,function(e,t){var n;!r||(n=d.GetSameGroupLink(t))&&0<n.length&&(d.PullLinkFromGroupStyle(t),u.each(n,function(e,t){d.SetNodeAttr(t,d.ConstInfo.AttrName.GROUP,o)})),d.SetNodeAttr(t,d.ConstInfo.AttrName.GROUP,o)}))},this.PushLinkToGroup=function(e,t){var n=E.enxHelper.AttrParameter(d.ConstInfo.AttrName.GROUP,t);n[E.enxConstField.AttrName.ENXFILE_ATTR_GROUPSHOW]="true",d.SetNodeAttr(e,d.ConstInfo.AttrName.GROUP,n),d.Property.CoreGraph.getModel().setValue(e,t),d.Property.CoreGraph.setCellStyle(d.ConstInfo.LinkGroupedStyle,[e]),this.CopyLink(e,!0)},this.CopyLink=function(e,t){t&&d.Property.CoreGraph.removeCells([e]),this.InsertLink(e.parent,e.id,e.value,e.source,e.target,e.style,e.data)},this.InsertLink=function(e,t,n,r,o,i,l){d.Property.CoreGraph.removeListener(d.ConnectHandler),this.Property.CoreGraph.getModel().beginUpdate();try{var a=d.Property.CoreGraph.insertEdge(e,t,n,r,o,i);this.AttachCell(a,l),l.group?(a.group=l.group.value||"",l.group.groupshow?(d.Property.CoreGraph.getModel().setValue(a,l.group.value),i=d.ConstInfo.LinkGroupedStyle,a.source.id==a.target.id&&(i=d.ConstInfo.LoopGroupLinkStyleName),d.Property.CoreGraph.setCellStyle(i,[a])):d.Property.CoreGraph.toggleCells(!1,[a])):r.id==o.id&&this.Property.CoreGraph.getModel().setStyle(a,d.ConstInfo.LoopLinkStyleName)}finally{this.Property.CoreGraph.getModel().endUpdate()}return d.Property.CoreGraph.addListener(mxEvent.CELL_CONNECTED,d.ConnectHandler),a},this.Copy=function(){var e=d.Property.CoreGraph.getSelectionCells(),e=E.jsonHelper.FilterListByValues(e,d.ConstInfo.AttrName.VERTEX,[!0]);mxClipboard.copy(d.Property.CoreGraph,e)},this.Paste=function(){var r=d.Property.CoreGraph,e=r.getImportableCells(mxClipboard.getCells());u.each(e,function(e,n){var t=h.CopyModel(n.data);t&&0<t.length&&u.each(t,function(e,t){0==e&&((e=d.Translater.GetJsonBond(t))[0]=r.popupMenuHandler.triggerX||e[0]+10,e[1]=r.popupMenuHandler.triggerY||e[1]+10,d.Translater.JsonToCell(r,t,r.getDefaultParent(),e,n.style))})})},this.selectAll=function(){d.Property.CoreGraph.selectAll()},this.PullLinkFromGroup=function(e){var t=d.GetSameGroupLink(e);u.each(t,function(e,t){d.RemoveNodeAttr(t,d.ConstInfo.AttrName.GROUP)}),d.Property.CoreGraph.toggleCells(!0,t),this.PullLinkFromGroupStyle(e),this.RemoveNodeAttr(e,d.ConstInfo.AttrName.GROUP)},this.PullLinkFromGroupStyle=function(e){var t=d.GetDisplayNodeName(e.data);d.Property.CoreGraph.getModel().setValue(e,t),e.source.id==e.target.id?this.Property.CoreGraph.getModel().setStyle(e,d.ConstInfo.LoopLinkStyleName):d.Property.CoreGraph.setCellStyle(d.ConstInfo.LinkUnGroupStyle,[e])},this.SelectItemHandle=function(){d.Property.CoreGraph.getDefaultParent();var e=d.Property.CoreGraph.getSelectionCells();d.Property.SelectedVertexId=[],d.Property.SelectedLinkId=[],u.each(e,function(e,t){t.vertex&&d.Property.SelectedVertexId.push(t[d.ConstInfo.AttrName.ID]),t.edge&&(d.Property.SelectedLinkId.push(t[d.ConstInfo.AttrName.ID]),t=d.GetSameGroupLink(t),u.each(t,function(e,t){d.Property.SelectedLinkId.push(t[d.ConstInfo.AttrName.ID])}))})},this.ClearChildren=function(){this.Property.LinkGroupIndex=0,d.Property.CoreGraph&&d.Property.CoreGraph.getModel()&&d.Property.CoreGraph.getModel().root&&d.Property.CoreGraph.getModel().clear()},this.CreateLinkGroupName=function(e){var t="";return e.group?t=e.group:(t=this.ConstInfo.LinkGroupPre+this.Property.LinkGroupIndex,this.Property.LinkGroupIndex++),t},this.ConstInfo=new function(){this.FixWidth=62,this.FixHeight=62,this.AttrName={PARENT:"parent",VALUE:"value",CONNECTABLE:"connectable",ID:"id",SOURCE:"source",STYLE:"style",TARGET:"target",VERTEX:"vertex",GEOMETRY:"geometry",EDGE:"edge",GROUP:"group",OBJNAME:"objname",BIGTYPE:"bigtype",DATA:"data",CANVASID:"canvasID",ISVIRTUALEDGE:"isVirtualEdge"},this.LinkGroupPre="Group",this.ElemntNamePre=new function(){this.Link="link",this.Ne="ne",this.Tester="tester",this.Dev="dev",this.Atm="atm",this.Eth="eth",this.Sdh="sdh",this.Board="board",this.SubBoard="subboard",this.Port="port",this.Network="network",this.Sftp="sftp",this.Agent="agent",this.VM="vm"},this.LinkGroupedStyle="strokeColor=#525ae9;strokeWidth=4;",this.LinkUnGroupStyle="strokeColor=#009b4d;strokeWidth=2;",this.SwimStyle="shape=swimlane;startSize=30;fillColor=#f6f6f6;strokeColor=#f6f6f6;fontColor=#333;",this.UsedPort="shape=swimlane;startSize=30;fillColor=#f6f6f6;strokeColor=#f6f6f6;fontColor=#999;",this.LineDefualtColor="#a5a5a5",this.LoopGroupLinkStyleName="LoopGroupLinkStyleName",this.LoopLinkStyleName="LoopLinkInCoreGraph",this.LoopGroupLinkInCoreGraph="LoopGroupLinkInCoreGraph",this.VirtualLinkStyleName="VirtualLinkStyleName",this.SubGraphHtml='<div id="graphContainer"></div>',this.EnumEditType={Topo:"Topo",Element:"Element",Network:"Network"}},this.EditType=this.ConstInfo.EnumEditType.Topo,this.Init()}return function(e){this.PlugObj={},this.Init=function(e){var t=new n;return t.Init(e),this.BindEvent(t),this.PlugObj=t},this.BindEvent=function(o){u(".spanEditorViewText").off("click").click(function(){o.ViewText()}),u(".spanEditorTopolimit").off("click").click(function(){u(".EPlugTopolimitSubmit").off("click").click(function(){var n=u("#txtTopoLimit").val(),e={BigType:E.enxHelper.ModelType.Topolimit,Name:n},r=!1;u.each(o.Property.DataList,function(e,t){t.BigType==E.enxHelper.ModelType.Topolimit&&(t.Name=n,r=!0)}),r||o.Property.DataList.push(e),u("#modalTopolimit").modal("hide")}),u(".EPlugTopolimitClose").off("click").click(function(){u("#modalTopolimit").modal("hide")}),u("#txtTopoLimit").val(""),u("#modalTopolimit").modal()}),u(".spanEditorBtnOpenEnx").off("click").click(function(){var r=u("#modalOpenEnx");u(".EPlugImportSubmit").off("click").click(function(){var e=u(".EPlugEnxInput").val(),t=u("#EPlugImportBtn").val();o.Property.FileName=t.substr(t.lastIndexOf("\\")+1);e=E.enxHelper.EnxToLstJson(e);o.SetData(e);var n="";u.each(e,function(e,t){n+=JSON.stringify(t)+"\n\r"}),u(".EPlugEnxInput").val(n),r.modal("hide")}),u(".EPlugImportClose").off("click").click(function(){r.modal("hide")}),u("#EPlugImportBtn").val(""),u(".EPlugEnxInput").val(""),r.modal()}),u(".spanEditorBtnSaveEnx").off("click").click(function(){o.SaveData(!0)}),u("#EPlugImportBtn").off("change").change(function(){var e,t;this.files&&(e=this.files[0],(t=new FileReader).readAsText(e,"UTF-8"),t.onload=function(e){e=e.target.result;u(".EPlugEnxInput").val(e)})}),u(".spanEditorBtnExportEnx").off("click").click(function(){o.ExportFile()}),u('[data-toggle="tooltip"]').tooltip(),u(".EplugGraphRightToggle").on("click",function(){o.toggleRightContainer(u(this).hasClass("left"))})},this.Init(e)}});